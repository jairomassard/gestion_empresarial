"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[767],{3767:function(e,t,a){a.r(t),a.d(t,{default:function(){return O}});var l=a(6768),o=a(4232),n=a(5130);const u={class:"daily-profit"},r={class:"filters"},s=["value"],d=["value"],i=["value"],c=["value"],v={key:0,class:"no-data-message"},y={key:1,class:"charts-container"},p={class:"chart-wrapper"},m={class:"chart-wrapper"},f={class:"pdv-selector"},C=["value"],k={key:2,class:"table-container"},h={class:"profit-table"},b={key:0,class:"total-row"};function D(e,t,a,D,E,P){const g=(0,l.g2)("Bar"),L=(0,l.g2)("Line");return(0,l.uX)(),(0,l.CE)("div",u,[(0,l.Lk)("h1",null,"Utilidad Diaria por PDV - "+(0,o.v_)(D.months[D.month-1].name)+" "+(0,o.v_)(D.year),1),(0,l.Lk)("div",r,[t[14]||(t[14]=(0,l.Lk)("label",null,"Año:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.year=e),onChange:t[1]||(t[1]=(...e)=>D.fetchData&&D.fetchData(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,o.v_)(e),9,s)))),128))],544),[[n.u1,D.year]]),t[15]||(t[15]=(0,l.Lk)("label",null,"Mes:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>D.month=e),onChange:t[3]||(t[3]=(...e)=>D.updateDaysAndFetch&&D.updateDaysAndFetch(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.months,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.num,value:e.num},(0,o.v_)(e.name),9,d)))),128))],544),[[n.u1,D.month]]),t[16]||(t[16]=(0,l.Lk)("label",null,"Estatus PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>D.status=e),onChange:t[5]||(t[5]=(...e)=>D.fetchData&&D.fetchData(...e))},t[11]||(t[11]=[(0,l.Lk)("option",{value:"Todos"},"Todos",-1),(0,l.Lk)("option",{value:"Activo"},"Activo",-1),(0,l.Lk)("option",{value:"Inactivo"},"Inactivo",-1)]),544),[[n.u1,D.status]]),t[17]||(t[17]=(0,l.Lk)("label",null,"PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>D.selectedPDV=e),onChange:t[7]||(t[7]=(...e)=>D.fetchData&&D.fetchData(...e))},[t[12]||(t[12]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.pdvs,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,o.v_)(e),9,i)))),128))],544),[[n.u1,D.selectedPDV]]),t[18]||(t[18]=(0,l.Lk)("label",null,"Día:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>D.selectedDay=e),onChange:t[9]||(t[9]=(...e)=>D.fetchData&&D.fetchData(...e))},[t[13]||(t[13]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.daysInMonth,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,o.v_)(e),9,c)))),128))],544),[[n.u1,D.selectedDay]])]),D.noData?((0,l.uX)(),(0,l.CE)("div",v," No hay datos disponibles para el mes, año y filtros seleccionados. ")):(0,l.Q3)("",!0),D.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("div",p,[t[19]||(t[19]=(0,l.Lk)("h2",null,"Utilidad Total por PDV",-1)),(0,l.bF)(g,{data:D.barChartData,options:D.barChartOptions},null,8,["data","options"])]),(0,l.Lk)("div",m,[t[22]||(t[22]=(0,l.Lk)("h2",null,"Tendencia de Utilidad Diaria",-1)),(0,l.Lk)("div",f,[t[21]||(t[21]=(0,l.Lk)("label",null,"Seleccionar PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>D.selectedPdv=e)},[t[20]||(t[20]=(0,l.Lk)("option",{value:"total"},"Total (Todos los PDVs)",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,o.v_)(e),9,C)))),128))],512),[[n.u1,D.selectedPdv]])]),(0,l.bF)(L,{data:D.lineChartData,options:D.lineChartOptions},null,8,["data","options"])])])),D.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",k,[(0,l.Lk)("table",h,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[t[23]||(t[23]=(0,l.Lk)("th",null,"Fecha",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e,colspan:"4"},(0,o.v_)(e),1)))),128)),t[24]||(t[24]=(0,l.Lk)("th",{colspan:"4"},"Total",-1))]),(0,l.Lk)("tr",null,[t[25]||(t[25]=(0,l.Lk)("th",null,null,-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e+"-ventas"},"Ventas")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e+"-costos"},"Costos")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e+"-produccion"},"Producción")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e+"-utilidad"},"Utilidad")))),128)),t[26]||(t[26]=(0,l.Lk)("th",null,"Ventas",-1)),t[27]||(t[27]=(0,l.Lk)("th",null,"Costos",-1)),t[28]||(t[28]=(0,l.Lk)("th",null,"Producción",-1)),t[29]||(t[29]=(0,l.Lk)("th",null,"Utilidad",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredDailyProfitData,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.date},[(0,l.Lk)("td",null,(0,o.v_)(e.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-ventas"},(0,o.v_)(D.formatCurrency(e[t].ventas)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-costos"},(0,o.v_)(D.formatCurrency(e[t].costos)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-produccion"},(0,o.v_)(D.formatCurrency(e[t].produccion)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-utilidad"},(0,o.v_)(D.formatCurrency(e[t].utilidad)),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(e.total.ventas)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(e.total.costos)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(e.total.produccion)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(e.total.utilidad)),1)])))),128)),D.filteredDailyProfitData.length>0?((0,l.uX)(),(0,l.CE)("tr",b,[(0,l.Lk)("td",null,(0,o.v_)(D.filteredTotals.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("td",{key:e+"-ventas"},(0,o.v_)(D.formatCurrency(D.filteredTotals[e].ventas)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("td",{key:e+"-costos"},(0,o.v_)(D.formatCurrency(D.filteredTotals[e].costos)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("td",{key:e+"-produccion"},(0,o.v_)(D.formatCurrency(D.filteredTotals[e].produccion)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("td",{key:e+"-utilidad"},(0,o.v_)(D.formatCurrency(D.filteredTotals[e].utilidad)),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.ventas)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.costos)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.produccion)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.utilidad)),1)])):(0,l.Q3)("",!0)])])]))])}a(4114),a(8111),a(1148),a(2489),a(7588),a(1701),a(8237);var E=a(144),P=a(782),g=a(1387),L=a(7682),F=a(1010),X=a(17),K=a(3408);a(8422);X.t1.register(X.hE,X.m_,X.s$,X.E8,X.No,X.FN,X.PP,X.kc,X.UA,K.A);var T={name:"DailyProfit",components:{Bar:F.yP,Line:F.N1},setup(){const e=(0,P.Pj)(),t=(0,g.rd)(),a=(0,E.KR)(null),o=(0,E.KR)([]),n=new Date,u=n.getMonth()+1,r=n.getFullYear(),s=(0,E.KR)(u),d=(0,E.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),i=(0,E.KR)("Activo"),c=(0,E.KR)("Todos"),v=(0,E.KR)("Todos"),y=(0,E.KR)([]),p=(0,E.KR)([]),m=(0,E.KR)([]),f=(0,E.KR)([]),C=(0,E.KR)([]),k=(0,E.KR)({}),h=(0,E.KR)({}),b=(0,E.KR)("total"),D=(0,l.EW)((()=>{const e=0===m.value.length||m.value.every((e=>0===e.total.utilidad));return console.log("noData:",e,"filteredDailyProfitData:",m.value),e})),F=()=>{if(!a.value||!s.value)return;const e={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};2!==s.value||a.value%4!==0||a.value%100===0&&a.value%400!==0||(e[2]=29);const t=e[s.value]||30;y.value=Array.from({length:t},((e,t)=>t+1)),v.value="Todos"},X=async()=>{try{const e=await L.A.get("/available-years");o.value=e.data.years||[],o.value.length>0&&(a.value=o.value.includes(r)?r:o.value[0],F(),K())}catch(e){console.error("Error fetching available years:",e),o.value=Array.from({length:5},((e,t)=>r+t-2)),a.value=r,F(),e.response&&401===e.response.status?t.push("/login"):K()}},K=async()=>{if(a.value)try{const e={year:a.value,month:s.value,status:i.value};"Todos"!==c.value&&(e.pdv=c.value),"Todos"!==v.value&&(e.day=v.value);const t=await L.A.get("/dashboard/daily-profit",{params:e});p.value=t.data.data||[],f.value=t.data.pdvs||[],k.value=t.data.totals||{},T(),console.log("Datos recibidos:",{dailyProfitData:p.value,pdvs:f.value,totals:k.value})}catch(e){console.error("Error fetching daily profit data:",e),p.value=[],f.value=[],k.value={},m.value=[],C.value=[],h.value={},e.response&&401===e.response.status&&t.push("/login")}},T=()=>{if("Todos"===c.value?C.value=f.value:C.value=f.value.filter((e=>e===c.value)),"Todos"===v.value)m.value=p.value;else{const e=v.value.toString().padStart(2,"0"),t=s.value.toString().padStart(2,"0"),l=`${e}/${t}/${a.value}`;m.value=p.value.filter((e=>e.date.includes(l)))}h.value={date:"TOTALES"},C.value.forEach((e=>{h.value[e]={ventas:m.value.reduce(((t,a)=>t+(a[e]?.ventas||0)),0),costos:m.value.reduce(((t,a)=>t+(a[e]?.costos||0)),0),produccion:m.value.reduce(((t,a)=>t+(a[e]?.produccion||0)),0),utilidad:m.value.reduce(((t,a)=>t+(a[e]?.utilidad||0)),0)}})),h.value.total={ventas:m.value.reduce(((e,t)=>e+(t.total?.ventas||0)),0),costos:m.value.reduce(((e,t)=>e+(t.total?.costos||0)),0),produccion:m.value.reduce(((e,t)=>e+(t.total?.produccion||0)),0),utilidad:m.value.reduce(((e,t)=>e+(t.total?.utilidad||0)),0)}},I=()=>{F(),K()},_=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),O=(0,l.EW)((()=>{const e={labels:C.value,datasets:[{label:"Utilidad Total (COP)",data:C.value.map((e=>h.value[e]?.utilidad||0)),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]};return console.log("barChartData:",e),e})),A={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)}}},x:{title:{display:!0,text:"Punto de Venta"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),t+=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e.parsed.y),t}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)}}}},V=(0,l.EW)((()=>{const e=m.value.map((e=>{const t=e.date.split(", ")[1],[a,l,o]=t.split("/");return`${o}-${l}-${a}`}));let t;t="total"===b.value?m.value.map((e=>e.total.utilidad)):m.value.map((e=>e[b.value]?.utilidad||0));const a={labels:e,datasets:[{label:"total"===b.value?"Utilidad Total (COP)":`Utilidad de ${b.value} (COP)`,data:t,fill:!1,borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.1}]};return console.log("lineChartData:",a),a})),R={responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"dd/MM/yyyy",displayFormats:{day:"dd/MM/yyyy"}},title:{display:!0,text:"Fecha"}},y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)}}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),t+=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e.parsed.y),t}}},datalabels:{display:!1}}};return(0,l.sV)((()=>{e.state.auth.token?X():t.push("/login")})),(0,l.wB)(b,(()=>{console.log("PDV seleccionado cambiado a:",b.value)})),{year:a,years:o,month:s,months:d,status:i,selectedPDV:c,selectedDay:v,daysInMonth:y,dailyProfitData:p,filteredDailyProfitData:m,pdvs:f,filteredPdvs:C,totals:k,filteredTotals:h,noData:D,selectedPdv:b,barChartData:O,barChartOptions:A,lineChartData:V,lineChartOptions:R,fetchData:K,updateDaysAndFetch:I,formatCurrency:_}}},I=a(1241);const _=(0,I.A)(T,[["render",D],["__scopeId","data-v-449bee01"]]);var O=_}}]);
//# sourceMappingURL=767.c2e4b790.js.map