"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[706],{5706:function(a,e,l){l.r(e),l.d(e,{default:function(){return X}});var t=l(6768),r=l(4232),o=l(5130);const n={class:"cargar-ventas"},c={class:"menu-buttons"},i={key:0,class:"form-section sync-warning"},s={key:1,class:"form-section"},u={class:"form-group"},d=["disabled"],v={key:2,class:"form-section"},f={class:"form-section"},p={class:"consulta-ventas form-section"},k={class:"form-group"},g={class:"form-group"},L={class:"form-group"},h={class:"form-group"},b=["value"],C={class:"form-group"},m=["value"],y={key:3,class:"resultados-ventas form-section"},F={class:"form-actions"},_={class:"table-container"},E=["onClick"],V={key:4,class:"detalle-venta form-section"},x={class:"form-actions"},A={class:"table-container"};function R(a,e,l,R,S,K){const P=(0,t.g2)("font-awesome-icon");return(0,t.uX)(),(0,t.CE)("div",n,[e[30]||(e[30]=(0,t.Lk)("h1",null,"Cargar Ventas Manualmente",-1)),(0,t.Lk)("section",c,[(0,t.Lk)("button",{onClick:e[0]||(e[0]=(...a)=>R.limpiarPagina&&R.limpiarPagina(...a)),class:"btn btn-warning"},"Limpiar Página")]),R.isSyncActive?((0,t.uX)(),(0,t.CE)("section",i,e[12]||(e[12]=[(0,t.Lk)("h2",null,"Advertencia",-1),(0,t.Lk)("p",null,[(0,t.eW)("El cargue de ventas se debe hacer por la página de "),(0,t.Lk)("strong",null,"Cargar Ventas Diarias"),(0,t.eW)(" del módulo de Análisis debido a la sincronización activa parametrizada entre los módulos de Analisis e Inventarios.")],-1)]))):(0,t.Q3)("",!0),R.isSyncActive?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("section",s,[e[14]||(e[14]=(0,t.Lk)("h2",null,"Subir Archivo CSV",-1)),(0,t.Lk)("div",u,[e[13]||(e[13]=(0,t.Lk)("label",{for:"inputCsv"},"Archivo CSV:",-1)),(0,t.Lk)("input",{id:"inputCsv",type:"file",accept:".csv",onChange:e[1]||(e[1]=(...a)=>R.cargarCsv&&R.cargarCsv(...a)),ref:"inputCsv"},null,544)]),(0,t.Lk)("button",{onClick:e[2]||(e[2]=(...a)=>R.procesarCsv&&R.procesarCsv(...a)),disabled:R.isProcessing},"Cargar Ventas",8,d)])),R.errores.length?((0,t.uX)(),(0,t.CE)("section",v,[e[15]||(e[15]=(0,t.Lk)("h2",null,"Errores Detectados:",-1)),(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.errores,((a,e)=>((0,t.uX)(),(0,t.CE)("li",{key:e},(0,r.v_)(a),1)))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("section",f,[e[16]||(e[16]=(0,t.Lk)("h2",null,"Descargar Plantilla",-1)),(0,t.Lk)("button",{onClick:e[3]||(e[3]=(...a)=>R.descargarPlantilla&&R.descargarPlantilla(...a))},"Descargar")]),(0,t.Lk)("section",p,[e[24]||(e[24]=(0,t.Lk)("h2",null,"Consulta de Facturas de Venta",-1)),(0,t.Lk)("div",k,[e[17]||(e[17]=(0,t.Lk)("label",{for:"filtroFactura"},"Número de Factura:",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>R.filtroFactura=a),id:"filtroFactura",placeholder:"Ingrese número de factura"},null,512),[[o.Jo,R.filtroFactura]])]),(0,t.Lk)("div",g,[e[18]||(e[18]=(0,t.Lk)("label",{for:"fechaInicio"},"Fecha Inicio:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=a=>R.fechaInicio=a),id:"fechaInicio"},null,512),[[o.Jo,R.fechaInicio]])]),(0,t.Lk)("div",L,[e[19]||(e[19]=(0,t.Lk)("label",{for:"fechaFin"},"Fecha Fin:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=a=>R.fechaFin=a),id:"fechaFin"},null,512),[[o.Jo,R.fechaFin]])]),(0,t.Lk)("div",h,[e[21]||(e[21]=(0,t.Lk)("label",{for:"filtroBodega"},"Bodega de Venta:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>R.filtroBodega=a),id:"filtroBodega"},[e[20]||(e[20]=(0,t.Lk)("option",{value:"",disabled:""},"Seleccione una bodega",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.bodegas,(a=>((0,t.uX)(),(0,t.CE)("option",{key:a.id,value:a.id},(0,r.v_)(a.nombre),9,b)))),128))],512),[[o.u1,R.filtroBodega]])]),(0,t.Lk)("div",C,[e[23]||(e[23]=(0,t.Lk)("label",{for:"selectorFactura"},"Seleccionar Factura:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>R.filtroFactura=a),id:"selectorFactura"},[e[22]||(e[22]=(0,t.Lk)("option",{value:"",disabled:""},"Seleccione una factura",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.facturas,(a=>((0,t.uX)(),(0,t.CE)("option",{key:a,value:a},(0,r.v_)(a),9,m)))),128))],512),[[o.u1,R.filtroFactura]])]),(0,t.Lk)("button",{onClick:e[9]||(e[9]=(...a)=>R.consultarVentas&&R.consultarVentas(...a))},"Consultar Facturas")]),R.resultadosVentas.length?((0,t.uX)(),(0,t.CE)("section",y,[e[27]||(e[27]=(0,t.Lk)("h3",null,"Resultados de la Consulta",-1)),(0,t.Lk)("div",F,[(0,t.Lk)("button",{onClick:e[10]||(e[10]=(...a)=>R.exportarListadoExcel&&R.exportarListadoExcel(...a))},[e[25]||(e[25]=(0,t.eW)("Exportar Listado ")),(0,t.bF)(P,{icon:"file-excel",class:"excel-icon"})])]),(0,t.Lk)("div",_,[(0,t.Lk)("table",null,[e[26]||(e[26]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Número de Factura"),(0,t.Lk)("th",null,"Fecha y Hora"),(0,t.Lk)("th",null,"Acción")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.resultadosVentas,(a=>((0,t.uX)(),(0,t.CE)("tr",{key:a.factura},[(0,t.Lk)("td",null,(0,r.v_)(a.factura),1),(0,t.Lk)("td",null,(0,r.v_)(a.fecha),1),(0,t.Lk)("td",null,[(0,t.Lk)("button",{onClick:e=>R.verDetalleVenta(a.factura),class:"btn btn-info"},"Detalle",8,E)])])))),128))])])])])):(0,t.Q3)("",!0),R.detalleVenta.length?((0,t.uX)(),(0,t.CE)("section",V,[(0,t.Lk)("h3",null,"Detalle de la Factura de Venta "+(0,r.v_)(R.facturaSeleccionada),1),(0,t.Lk)("div",x,[(0,t.Lk)("button",{onClick:e[11]||(e[11]=(...a)=>R.exportarDetalleExcel&&R.exportarDetalleExcel(...a))},[e[28]||(e[28]=(0,t.eW)("Exportar ")),(0,t.bF)(P,{icon:"file-excel",class:"excel-icon"})])]),(0,t.Lk)("div",A,[(0,t.Lk)("table",null,[e[29]||(e[29]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Código"),(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Cantidad"),(0,t.Lk)("th",null,"Bodega de Venta"),(0,t.Lk)("th",null,"Precio Unitario")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.detalleVenta,(a=>((0,t.uX)(),(0,t.CE)("tr",{key:a.id},[(0,t.Lk)("td",null,(0,r.v_)(a.codigo),1),(0,t.Lk)("td",null,(0,r.v_)(a.nombre),1),(0,t.Lk)("td",null,(0,r.v_)(a.cantidad),1),(0,t.Lk)("td",null,(0,r.v_)(a.bodega),1),(0,t.Lk)("td",null,(0,r.v_)(null!==a.precio_unitario?`$${a.precio_unitario.toFixed(2)}`:"N/A"),1)])))),128))])])])])):(0,t.Q3)("",!0)])}l(4114),l(8111),l(116),l(1701),l(4603),l(7566),l(8721);var S=l(144),K=l(1387),P=l(7682),w=l(3230),D={name:"CargarVentasManual",setup(){const a=(0,K.rd)(),e=(0,S.KR)(null),l=(0,S.KR)(null),r=(0,S.KR)([]),o=(0,S.KR)(""),n=(0,S.KR)(""),c=(0,S.KR)(""),i=(0,S.KR)(""),s=(0,S.KR)([]),u=(0,S.KR)([]),d=(0,S.KR)([]),v=(0,S.KR)([]),f=(0,S.KR)(""),p=(0,S.KR)(!1),k=(0,S.KR)(!1),g=async()=>{try{const a=await P.A.get("/inventory/verificar-sincronizacion");k.value=a.data.sync_analisis_inventario}catch(a){console.error("Error al verificar sincronización:",a),r.value=["No se pudo verificar la sincronización con el módulo de Análisis."]}},L=a=>{e.value=a.target.files[0],r.value=[]},h=async()=>{if(!e.value)return void(r.value=["Seleccione un archivo CSV para cargar"]);p.value=!0;const l=new FormData;l.append("file",e.value);try{const a=await P.A.post("/inventory/ventas",l);r.value=[],alert(a.data.message),y(),C()}catch(t){console.error("Error al cargar ventas:",t),t.response?.data?.errors?r.value=t.response.data.errors:r.value=[t.response?.data?.message||"Ocurrió un error al cargar las ventas."],401===t.response?.status&&a.push("/login")}finally{p.value=!1}},b=()=>{const a=[["factura","codigo","nombre","cantidad","fecha_venta","bodega","precio_unitario"],["FB1234567","PROD001","ARROZ ESPECIAL PERSONAL","10","2025-04-28 10:00:00","Almacen principal","5000.00"],["CC8901234","PROD002","PASTA ESPECIAL PERSONAL","5","2025-04-28 11:30:00","Bodega Norte",""]],e=a.map((a=>a.join(","))).join("\n"),l=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(l),t.setAttribute("download","plantilla_cargue_ventas.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},C=()=>{e.value=null,l.value&&(l.value.value="")},m=()=>{C(),r.value=[],o.value="",n.value="",c.value="",i.value="",d.value=[],v.value=[],f.value=""},y=async()=>{try{const a=await P.A.get("/inventory/ventas-facturas");s.value=a.data.facturas}catch(a){console.error("Error al cargar facturas:",a),alert("Ocurrió un error al cargar las facturas.")}},F=async()=>{try{const a=await P.A.get("/inventory/bodegas");u.value=a.data}catch(a){console.error("Error al cargar bodegas:",a),alert("Ocurrió un error al cargar las bodegas.")}},_=async()=>{try{const a={factura:o.value||void 0,fecha_inicio:n.value||void 0,fecha_fin:c.value||void 0,bodega_id:i.value||void 0},e=await P.A.get("/inventory/consultar-ventas",{params:a});d.value=e.data,v.value=[]}catch(a){console.error("Error al consultar facturas de venta:",a),alert("Ocurrió un error al consultar las facturas.")}},E=async a=>{try{f.value=a;const e=await P.A.get("/inventory/detalle-venta",{params:{factura:a}});v.value=e.data}catch(e){console.error("Error al obtener detalle de la factura:",e),alert("No se pudo recuperar el detalle de la factura.")}},V=()=>{if(!d.value.length)return void alert("No hay datos para exportar a Excel.");const a=u.value.find((a=>a.id===i.value))?.nombre||"Todas",e=[["Resultado de consulta de Facturas de Ventas Cargadas"],[`Número de Factura: ${o.value||"Todos"}`],[`Fecha Inicio: ${n.value||"No especificada"}`],[`Fecha Fin: ${c.value||"No especificada"}`],[`Bodega: ${a}`],[],["Número de Factura","Fecha y Hora"],...d.value.map((a=>[a.factura,a.fecha]))],l=w.Wp.aoa_to_sheet(e),t=w.Wp.book_new();w.Wp.book_append_sheet(t,l,"Facturas"),w._h(t,`facturas_ventas_${(new Date).toISOString().slice(0,10)}.xlsx`)},x=()=>{if(!v.value.length)return void alert("No hay datos para exportar a Excel.");const a=d.value.find((a=>a.factura===f.value))?.fecha||"Desconocida",e=[[`Detalle Factura ${f.value}`],[`Fecha de Cargue: ${a}`],[],["Código","Nombre","Cantidad","Bodega de Venta","Precio Unitario"],...v.value.map((a=>[a.codigo,a.nombre,a.cantidad,a.bodega,null!==a.precio_unitario?a.precio_unitario.toFixed(2):"N/A"]))],l=w.Wp.aoa_to_sheet(e),t=w.Wp.book_new();w.Wp.book_append_sheet(t,l,"Detalle Factura"),w._h(t,`detalle_factura_${f.value}.xlsx`)};return(0,t.sV)((async()=>{await g(),k.value||(y(),F())})),{archivoCsv:e,inputCsv:l,errores:r,filtroFactura:o,fechaInicio:n,fechaFin:c,filtroBodega:i,facturas:s,bodegas:u,resultadosVentas:d,detalleVenta:v,facturaSeleccionada:f,isProcessing:p,isSyncActive:k,cargarCsv:L,procesarCsv:h,descargarPlantilla:b,limpiarPagina:m,cargarFacturas:y,cargarBodegas:F,consultarVentas:_,verDetalleVenta:E,exportarListadoExcel:V,exportarDetalleExcel:x}}},I=l(1241);const N=(0,I.A)(D,[["render",R],["__scopeId","data-v-6e0db534"]]);var X=N}}]);
//# sourceMappingURL=706.b7d9a9f6.js.map