"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[544],{531:function(o,t,i){var s=i(6518),r=i(9565),a=i(9306),e=i(8551),n=i(1767),d=i(8646),l=i(9462),c=i(9539),u=i(6395),m=l((function(){var o,t,i=this.iterator,s=this.mapper;while(1){if(t=this.inner)try{if(o=e(r(t.next,t.iterator)),!o.done)return o.value;this.inner=null}catch(a){c(i,"throw",a)}if(o=e(r(this.next,i)),this.done=!!o.done)return;try{this.inner=d(s(o.value,this.counter++),!1)}catch(a){c(i,"throw",a)}}}));s({target:"Iterator",proto:!0,real:!0,forced:u},{flatMap:function(o){return e(this),a(o),new m(n(this),{mapper:o,inner:null})}})},4544:function(o,t,i){i.r(t),i.d(t,{default:function(){return z}});i(8111),i(8237);var s=i(6768),r=i(5130),a=i(4232);const e={class:"consulta-inventario"},n={class:"form-section"},d={class:"form-actions",style:{"justify-content":"flex-end"}},l={class:"form-group"},c={class:"form-group"},u={class:"form-group"},m=["value"],g={class:"form-group"},h={class:"form-actions"},p={key:0,class:"form-section"},b={class:"form-group"},k=["value"],f={class:"form-group"},_={key:1,class:"form-section"},v={class:"table-container"},L={class:"resumen-costos"},C={class:"total-row"},P={key:2},D={class:"form-actions"},E={class:"table-container"},A={key:0},F={key:0,class:"estado verde"},N={key:1,class:"estado amarillo"},y={key:2,class:"estado rojo"},I={key:1},x={key:0,class:"paginacion"},X=["disabled"],w=["disabled"];function S(o,t,i,S,M,T){const B=(0,s.g2)("font-awesome-icon");return(0,s.uX)(),(0,s.CE)("div",e,[t[35]||(t[35]=(0,s.Lk)("h1",null,"Consulta de Inventario",-1)),(0,s.Lk)("section",n,[(0,s.Lk)("div",d,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...o)=>T.limpiarPagina&&T.limpiarPagina(...o)),class:"btn btn-warning"},"Limpiar Página")]),(0,s.Lk)("div",l,[t[16]||(t[16]=(0,s.Lk)("label",{for:"nombreFiltro"},"Buscar por nombre:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"nombreFiltro","onUpdate:modelValue":t[1]||(t[1]=o=>M.nombreDigitado=o),placeholder:"Ingrese nombre del producto",onInput:t[2]||(t[2]=(...o)=>T.sincronizarPorNombre&&T.sincronizarPorNombre(...o))},null,544),[[r.Jo,M.nombreDigitado]])]),(0,s.Lk)("div",c,[t[17]||(t[17]=(0,s.Lk)("label",{for:"codigoFiltro"},"Buscar por código:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>M.codigoDigitado=o),id:"codigoFiltro",placeholder:"Ingrese código de producto",onInput:t[4]||(t[4]=(...o)=>T.sincronizarCodigoConSelector&&T.sincronizarCodigoConSelector(...o))},null,544),[[r.Jo,M.codigoDigitado]])]),(0,s.Lk)("div",u,[t[19]||(t[19]=(0,s.Lk)("label",{for:"productoSelector"},"Seleccione un producto:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>M.filtroProducto=o),id:"productoSelector",onChange:t[6]||(t[6]=(...o)=>T.sincronizarSelectorConCodigo&&T.sincronizarSelectorConCodigo(...o))},[t[18]||(t[18]=(0,s.Lk)("option",{value:""},"Todos",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(M.productosDisponibles,(o=>((0,s.uX)(),(0,s.CE)("option",{key:o.codigo,value:o.codigo},(0,a.v_)(o.codigo)+" - "+(0,a.v_)(o.nombre),9,m)))),128))],544),[[r.u1,M.filtroProducto]])]),(0,s.Lk)("div",g,[t[21]||(t[21]=(0,s.Lk)("label",{for:"filtroEstado"},"Filtrar por Estado:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>M.filtroEstado=o),id:"filtroEstado",onChange:t[8]||(t[8]=(...o)=>T.consultar&&T.consultar(...o))},t[20]||(t[20]=[(0,s.Lk)("option",{value:""},"Todos",-1),(0,s.Lk)("option",{value:"verde"},"Verde (OK)",-1),(0,s.Lk)("option",{value:"amarillo"},"Amarillo (Advertencia)",-1),(0,s.Lk)("option",{value:"rojo"},"Rojo (Crítico)",-1)]),544),[[r.u1,M.filtroEstado]])]),(0,s.Lk)("div",h,[(0,s.Lk)("button",{onClick:t[9]||(t[9]=(...o)=>T.consultar&&T.consultar(...o)),class:"btn"},"Consultar Inventario")])]),M.mostrarInventario&&""===M.filtroProducto&&""===M.codigoDigitado&&""===M.nombreDigitado?((0,s.uX)(),(0,s.CE)("section",p,[(0,s.Lk)("div",b,[t[23]||(t[23]=(0,s.Lk)("label",{for:"filtroBodega"},"Filtrar por bodega:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>M.filtroBodega=o),id:"filtroBodega",onChange:t[11]||(t[11]=(...o)=>T.filtrarPorBodega&&T.filtrarPorBodega(...o))},[t[22]||(t[22]=(0,s.Lk)("option",{value:""},"Todas",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(M.bodegas,(o=>((0,s.uX)(),(0,s.CE)("option",{key:o,value:o},(0,a.v_)(o),9,k)))),128))],544),[[r.u1,M.filtroBodega]])]),(0,s.Lk)("div",f,[t[24]||(t[24]=(0,s.Lk)("label",{for:"umbralAlerta"},"Umbral de Alerta (%):",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>M.umbralAlerta=o),id:"umbralAlerta",type:"number",min:"0",max:"100",step:"0.01"},null,512),[[r.Jo,M.umbralAlerta,void 0,{number:!0}]])])])):(0,s.Q3)("",!0),M.mostrarInventario&&""===M.filtroProducto&&""===M.codigoDigitado&&""===M.nombreDigitado?((0,s.uX)(),(0,s.CE)("section",_,[t[27]||(t[27]=(0,s.Lk)("h2",null,"Resumen de Costos por Almacén",-1)),(0,s.Lk)("div",v,[(0,s.Lk)("table",L,[t[26]||(t[26]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Almacén"),(0,s.Lk)("th",null,"Costo Total")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(T.resumenCostos,((o,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t},[(0,s.Lk)("td",null,(0,a.v_)(t),1),(0,s.Lk)("td",null,"$"+(0,a.v_)(T.formatCosto(o)),1)])))),128)),(0,s.Lk)("tr",C,[t[25]||(t[25]=(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,"TOTAL")],-1)),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,"$"+(0,a.v_)(T.formatCosto(Object.values(T.resumenCostos).reduce(((o,t)=>o+t),0))),1)])])])])])])):(0,s.Q3)("",!0),M.mostrarInventario?((0,s.uX)(),(0,s.CE)("section",P,[t[34]||(t[34]=(0,s.Lk)("h2",null,"Inventario de Productos",-1)),(0,s.Lk)("div",D,[M.productosFiltrados.length?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[13]||(t[13]=(...o)=>T.exportarAExcel&&T.exportarAExcel(...o)),class:"btn"},[t[28]||(t[28]=(0,s.eW)(" Exportar a Excel ")),(0,s.bF)(B,{icon:"file-excel",class:"excel-icon"})])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",E,[(0,s.Lk)("table",null,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[t[29]||(t[29]=(0,s.Lk)("th",null,"Código",-1)),t[30]||(t[30]=(0,s.Lk)("th",null,"Nombre",-1)),t[31]||(t[31]=(0,s.Lk)("th",null,"Stock Mínimo",-1)),t[32]||(t[32]=(0,s.Lk)("th",null,"Total",-1)),t[33]||(t[33]=(0,s.Lk)("th",null,"Estado",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(M.bodegasMostradas,(o=>((0,s.uX)(),(0,s.CE)(s.FK,{key:o},[(0,s.Lk)("th",null,(0,a.v_)(o),1),(0,s.Lk)("th",null,"Costo Total "+(0,a.v_)(o),1)],64)))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(M.productosFiltrados,(o=>((0,s.uX)(),(0,s.CE)("tr",{key:o.codigo},[(0,s.Lk)("td",null,(0,a.v_)(o.codigo),1),(0,s.Lk)("td",null,(0,a.v_)(o.nombre),1),(0,s.Lk)("td",null,(0,a.v_)(null!==o.stock_minimo?o.stock_minimo:"-"),1),(0,s.Lk)("td",null,(0,a.v_)(T.formatCantidad(o.cantidad_total||0)),1),(0,s.Lk)("td",null,[null!==o.stock_minimo&&void 0!==o.stock_minimo?((0,s.uX)(),(0,s.CE)("span",A,[Number(o.cantidad_total)>Number(o.stock_minimo)*(1+Number(M.umbralAlerta)/100)?((0,s.uX)(),(0,s.CE)("span",F,"✔")):Number(o.cantidad_total)>Number(o.stock_minimo)?((0,s.uX)(),(0,s.CE)("span",N,"⚠")):((0,s.uX)(),(0,s.CE)("span",y,"✖"))])):((0,s.uX)(),(0,s.CE)("span",I,"-"))]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(M.bodegasMostradas,(t=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t},[(0,s.Lk)("td",null,(0,a.v_)(T.formatCantidad(o.cantidades_por_bodega[t]||0)),1),(0,s.Lk)("td",null,"$"+(0,a.v_)(T.formatCosto(o.costos_por_bodega[t]||0)),1)],64)))),128))])))),128))])])]),""===M.filtroProducto&&""===M.codigoDigitado&&""===M.nombreDigitado?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("button",{disabled:1===M.paginaActual,onClick:t[14]||(t[14]=o=>T.cambiarPagina(M.paginaActual-1)),class:"btn"},"Anterior",8,X),(0,s.Lk)("span",null,"Página "+(0,a.v_)(M.paginaActual),1),(0,s.Lk)("button",{disabled:M.productosFiltrados.length<M.limite,onClick:t[15]||(t[15]=o=>T.cambiarPagina(M.paginaActual+1)),class:"btn"},"Siguiente",8,w)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])}i(4114),i(2489),i(116),i(531),i(7588),i(1701);var M=i(7682),T=i(3230),B=i(292),O={name:"ConsultaInventario",components:{FontAwesomeIcon:B.gc},data(){return{filtroProducto:"",codigoDigitado:"",nombreDigitado:"",productosDisponibles:[],productos:[],productosFiltrados:[],bodegas:[],bodegasMostradas:[],filtroBodega:"",filtroEstado:"",mostrarInventario:!1,paginaActual:1,limite:20,todosLosProductos:[],umbralAlerta:10}},computed:{resumenCostos(){const o={};return this.bodegas.forEach((t=>{o[t]=this.todosLosProductos.reduce(((o,i)=>o+(i.costos_por_bodega[t]||0)),0)})),o}},methods:{limpiarPagina(){this.codigoDigitado="",this.nombreDigitado="",this.filtroProducto="",this.filtroBodega="",this.filtroEstado="",this.productos=[],this.productosFiltrados=[],this.bodegas=[],this.bodegasMostradas=[],this.mostrarInventario=!1,this.paginaActual=1,this.todosLosProductos=[],this.umbralAlerta=10},async consultar(){this.filtroProducto||this.codigoDigitado||this.nombreDigitado?(await this.consultarProductoEspecifico(),this.filtroEstado&&this.filtrarPorEstado()):(await this.consultarTodosLosProductos(),this.filtroEstado&&this.filtrarPorEstado())},async consultarProductoEspecifico(){try{const o=this.filtroProducto||this.codigoDigitado;let t="";if(o)t=`/api/inventario-con-costos/${o}`;else{if(!this.nombreDigitado)return alert("Por favor, ingrese un código o nombre de producto."),this.mostrarInventario=!1,this.productos=[],this.bodegas=[],void(this.productosFiltrados=[]);t=`/api/inventario-con-costos?nombre=${encodeURIComponent(this.nombreDigitado)}&limit=999999`}const i=await M.A.get(t),s=i.data;if(s.message)return alert(s.message),this.mostrarInventario=!1,this.productos=[],this.bodegas=[],void(this.productosFiltrados=[]);const r=await M.A.get("/inventory/bodegas"),a=r.data.map((o=>o.nombre));if(this.bodegas=a,this.bodegasMostradas=a,s.producto){const o=s.inventario||[];this.productos=[{codigo:s.producto.codigo,nombre:s.producto.nombre,cantidad_total:o.reduce(((o,t)=>{const i=Number(t.cantidad)||0;return o+i}),0),stock_minimo:null!==s.producto.stock_minimo?Number(s.producto.stock_minimo):null,cantidades_por_bodega:a.reduce(((t,i)=>{const s=o.find((o=>o.bodega===i));return t[i]=s&&Number(s.cantidad)||0,t}),{}),costos_por_bodega:a.reduce(((t,i)=>{const s=o.find((o=>o.bodega===i));return t[i]=s&&Number(s.costo_total)||0,t}),{})}]}else{if(!s.productos)return alert("No se encontraron datos para el producto especificado."),this.productos=[],this.productosFiltrados=[],void(this.mostrarInventario=!1);this.productos=s.productos.sort(((o,t)=>o.codigo.localeCompare(t.codigo))).map((o=>({codigo:o.codigo,nombre:o.nombre,cantidad_total:Number(o.cantidad_total)||0,stock_minimo:null!==o.stock_minimo?Number(o.stock_minimo):null,cantidades_por_bodega:Object.keys(o.cantidades_por_bodega).reduce(((t,i)=>(t[i]=Number(o.cantidades_por_bodega[i])||0,t)),{}),costos_por_bodega:Object.keys(o.costos_por_bodega).reduce(((t,i)=>(t[i]=Number(o.costos_por_bodega[i])||0,t)),{})})))}this.productosFiltrados=[...this.productos],this.mostrarInventario=!0}catch(o){const t=o.response?.data?.error||o.response?.data?.message||o.message;alert(`Error al consultar el inventario: ${t}`),this.mostrarInventario=!1,this.productos=[],this.productosFiltrados=[]}},async consultarTodosLosProductos(){try{const o=await M.A.get("/api/inventario-con-costos?limit=999999"),{productos:t,bodegas:i}=o.data;if(!t||0===t.length)return alert("No se encontró información en el inventario."),this.mostrarInventario=!1,this.bodegas=[],this.productos=[],this.productosFiltrados=[],void(this.todosLosProductos=[]);this.bodegas=i||[],this.bodegasMostradas=[...this.bodegas],this.todosLosProductos=t.sort(((o,t)=>o.codigo.localeCompare(t.codigo))).map((o=>({codigo:o.codigo,nombre:o.nombre,cantidad_total:Number(o.cantidad_total)||0,stock_minimo:null!==o.stock_minimo?Number(o.stock_minimo):null,cantidades_por_bodega:Object.keys(o.cantidades_por_bodega).reduce(((t,i)=>(t[i]=Number(o.cantidades_por_bodega[i])||0,t)),{}),costos_por_bodega:Object.keys(o.costos_por_bodega).reduce(((t,i)=>(t[i]=Number(o.costos_por_bodega[i])||0,t)),{})})));const s=(this.paginaActual-1)*this.limite;this.productos=this.todosLosProductos.slice(s,s+this.limite),this.productosFiltrados=[...this.productos],this.mostrarInventario=!0}catch(o){const t=o.response?.data?.error||o.response?.data?.message||o.message;alert(`Error al consultar el inventario general: ${t}`)}},filtrarPorBodega(){this.filtroBodega?(this.bodegasMostradas=[this.filtroBodega],this.productosFiltrados=this.todosLosProductos.filter((o=>(o.cantidades_por_bodega[this.filtroBodega]||0)>0)).slice((this.paginaActual-1)*this.limite,this.paginaActual*this.limite)):(this.bodegasMostradas=[...this.bodegas],this.productosFiltrados=this.todosLosProductos.slice((this.paginaActual-1)*this.limite,this.paginaActual*this.limite))},filtrarPorEstado(){if(this.filtroEstado){const o=this.filtroProducto||this.codigoDigitado||this.nombreDigitado?this.productos:this.todosLosProductos;this.productosFiltrados=o.filter((o=>{if(null===o.stock_minimo||void 0===o.stock_minimo)return!1;const t=Math.ceil(Number(o.stock_minimo)*(Number(this.umbralAlerta)/100)),i=Number(o.cantidad_total)-Number(o.stock_minimo);return"verde"===this.filtroEstado?i>t:"amarillo"===this.filtroEstado?i<=t&&i>0:"rojo"===this.filtroEstado&&i<=0})),this.filtroProducto||this.codigoDigitado||this.nombreDigitado||(this.productosFiltrados=this.productosFiltrados.slice((this.paginaActual-1)*this.limite,this.paginaActual*this.limite))}else{if(this.filtroProducto||this.codigoDigitado||this.nombreDigitado)return;this.productosFiltrados=this.todosLosProductos.slice((this.paginaActual-1)*this.limite,this.paginaActual*this.limite)}},async cargarProductosDisponibles(){try{const o=await M.A.get("/api/productos/completos");this.productosDisponibles=o.data.sort(((o,t)=>o.codigo.localeCompare(t.codigo)))}catch(o){const t=o.response?.data?.error||o.response?.data?.message||o.message;alert(`Error al cargar productos disponibles: ${t}`)}},cambiarPagina(o){this.paginaActual=o;const t=(this.paginaActual-1)*this.limite;this.productos=this.todosLosProductos.slice(t,t+this.limite),this.productosFiltrados=[...this.productos]},sincronizarPorNombre(){if(!this.nombreDigitado)return this.filtroProducto="",void(this.codigoDigitado="");const o=this.productosDisponibles.find((o=>o.nombre.toLowerCase().includes(this.nombreDigitado.toLowerCase())));o&&(this.filtroProducto=o.codigo,this.codigoDigitado=o.codigo)},sincronizarCodigoConSelector(){if(!this.codigoDigitado)return this.filtroProducto="",void(this.nombreDigitado="");const o=this.productosDisponibles.find((o=>o.codigo.toLowerCase()===this.codigoDigitado.toLowerCase()));o&&(this.filtroProducto=o.codigo,this.nombreDigitado=o.nombre)},sincronizarSelectorConCodigo(){if(!this.filtroProducto)return this.codigoDigitado="",void(this.nombreDigitado="");const o=this.productosDisponibles.find((o=>o.codigo===this.filtroProducto));o&&(this.codigoDigitado=o.codigo,this.nombreDigitado=o.nombre)},formatCosto(o){return Number(o).toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2})},formatCantidad(o){return Number(o).toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2})},exportarAExcel(){const o=this.filtroProducto||this.codigoDigitado||this.nombreDigitado?this.productosFiltrados:this.todosLosProductos;let t=[];this.filtroProducto||this.codigoDigitado||this.nombreDigitado||(t=[["Resumen de Costos por Almacén"],["Almacén","Costo Total"],...Object.entries(this.resumenCostos).map((([o,t])=>[o,Number(t).toFixed(2)])),["TOTAL",Number(Object.values(this.resumenCostos).reduce(((o,t)=>o+t),0)).toFixed(2)],[""]]);const i=o=>{if(null===o.stock_minimo||void 0===o.stock_minimo)return"-";const t=Number(o.cantidad_total),i=Number(o.stock_minimo),s=Math.ceil(i*(Number(this.umbralAlerta)/100));return t>i+s?"✔":t>i?"⚠":"✖"};t.push(["Inventario de Productos"],["Código","Nombre","Stock Mínimo","Total","Estado",...this.bodegas.flatMap((o=>[o,`Costo Total ${o}`]))],...o.map((o=>[o.codigo,o.nombre,null!==o.stock_minimo?o.stock_minimo:"-",Number(o.cantidad_total).toFixed(2),i(o),...this.bodegas.flatMap((t=>[Number(o.cantidades_por_bodega[t]||0).toFixed(2),Number(o.costos_por_bodega[t]||0).toFixed(2)]))])));const s=T.Wp.aoa_to_sheet(t),r=T.Wp.book_new();T.Wp.book_append_sheet(r,s,"Inventario"),T._h(r,`inventario_${(new Date).toISOString().slice(0,10)}.xlsx`)}},mounted(){this.cargarProductosDisponibles()}},j=i(1241);const $=(0,j.A)(O,[["render",S],["__scopeId","data-v-53bde8ea"]]);var z=$},8646:function(o,t,i){var s=i(9565),r=i(8551),a=i(1767),e=i(851);o.exports=function(o,t){t&&"string"===typeof o||r(o);var i=e(o);return a(r(void 0!==i?s(i,o):o))}}}]);
//# sourceMappingURL=544.1c1e4cd8.js.map