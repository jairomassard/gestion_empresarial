"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[118],{5118:function(a,t,e){e.r(t),e.d(t,{default:function(){return W}});var o=e(6768),n=e(4232),l=e(5130);const r={class:"product-profit"},s={key:0},d={class:"filters"},u=["value"],i=["value"],c=["value"],p=["value"],v={class:"actions"},h={key:0,class:"no-data-message"},m={key:1,class:"charts-container"},y={class:"chart-wrapper"},b={class:"chart-wrapper"},g={key:2,class:"table-container"},k={class:"profit-table"},C={class:"total-row"};function f(a,t,e,f,L,_){const D=(0,o.g2)("Bar");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("h1",null,[(0,o.eW)("Margen de Utilidad por Producto - "+(0,n.v_)(f.months[f.month-1].name)+" "+(0,n.v_)(f.year)+" ",1),f.day?((0,o.uX)(),(0,o.CE)("span",s," (Día "+(0,n.v_)(f.day)+")",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",d,[t[13]||(t[13]=(0,o.Lk)("label",null,"Año:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>f.year=a),onChange:t[1]||(t[1]=(...a)=>f.updateDaysAndFetch&&f.updateDaysAndFetch(...a))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.years,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a,value:a},(0,n.v_)(a),9,u)))),128))],544),[[l.u1,f.year]]),t[14]||(t[14]=(0,o.Lk)("label",null,"Mes:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>f.month=a),onChange:t[3]||(t[3]=(...a)=>f.updateDaysAndFetch&&f.updateDaysAndFetch(...a))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.months,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a.num,value:a.num},(0,n.v_)(a.name),9,i)))),128))],544),[[l.u1,f.month]]),t[15]||(t[15]=(0,o.Lk)("label",null,"Día:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>f.day=a),onChange:t[5]||(t[5]=(...a)=>f.fetchData&&f.fetchData(...a))},[t[11]||(t[11]=(0,o.Lk)("option",{value:""},"Todos",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.daysInMonth,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a,value:a},(0,n.v_)(a),9,c)))),128))],544),[[l.u1,f.day]]),t[16]||(t[16]=(0,o.Lk)("label",null,"Producto:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>f.selectedProduct=a),onChange:t[7]||(t[7]=(...a)=>f.fetchData&&f.fetchData(...a))},[t[12]||(t[12]=(0,o.Lk)("option",{value:""},"Todos",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.products,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a.descripcion,value:a.descripcion},(0,n.v_)(a.descripcion),9,p)))),128))],544),[[l.u1,f.selectedProduct]])]),(0,o.Lk)("div",v,[(0,o.Lk)("button",{onClick:t[8]||(t[8]=(...a)=>f.exportToExcel&&f.exportToExcel(...a))},"Exportar a Excel"),(0,o.Lk)("button",{onClick:t[9]||(t[9]=a=>f.downloadChart("profitChart"))},"Descargar Gráfico de Margen"),(0,o.Lk)("button",{onClick:t[10]||(t[10]=a=>f.downloadChart("salesVsCostsChart"))},"Descargar Gráfico de Ventas y Costos")]),f.noData?((0,o.uX)(),(0,o.CE)("div",h," No hay datos disponibles para el mes, año, día y filtros seleccionados. ")):(0,o.Q3)("",!0),f.noData?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",m,[(0,o.Lk)("div",y,[(0,o.Lk)("h2",null,"Margen y Utilidad por Producto ("+(0,n.v_)(f.chartData.length<f.productProfitData.length?"Top 10":"Todos")+")",1),(0,o.bF)(D,{id:"profitChart",data:f.barChartData,options:f.barChartOptions},null,8,["data","options"])]),(0,o.Lk)("div",b,[(0,o.Lk)("h2",null,"Ventas vs Costos y Utilidad ("+(0,n.v_)(f.chartData.length<f.productProfitData.length?"Top 10":"Todos")+")",1),(0,o.bF)(D,{id:"salesVsCostsChart",data:f.salesVsCostsChartData,options:f.salesVsCostsChartOptions},null,8,["data","options"])])])),f.noData?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",g,[(0,o.Lk)("table",k,[t[19]||(t[19]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Producto"),(0,o.Lk)("th",null,"Cantidad Vendida"),(0,o.Lk)("th",null,"Ventas"),(0,o.Lk)("th",null,"Costos"),(0,o.Lk)("th",null,"Producción"),(0,o.Lk)("th",null,"Utilidad"),(0,o.Lk)("th",null,"Margen (%)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.productProfitData,(a=>((0,o.uX)(),(0,o.CE)("tr",{key:a.descripcion},[(0,o.Lk)("td",null,(0,n.v_)(a.descripcion),1),(0,o.Lk)("td",null,(0,n.v_)(a.cantidad_vendida.toFixed(2)),1),(0,o.Lk)("td",null,(0,n.v_)(f.formatCurrency(a.ventas)),1),(0,o.Lk)("td",null,(0,n.v_)(f.formatCurrency(a.costos)),1),(0,o.Lk)("td",null,(0,n.v_)(f.formatCurrency(a.produccion)),1),(0,o.Lk)("td",null,(0,n.v_)(f.formatCurrency(a.utilidad)),1),(0,o.Lk)("td",null,(0,n.v_)(a.margen.toFixed(2))+"%",1)])))),128)),(0,o.Lk)("tr",C,[t[17]||(t[17]=(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,"Total")],-1)),t[18]||(t[18]=(0,o.Lk)("td",null,"-",-1)),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,n.v_)(f.formatCurrency(f.totals.ventas)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,n.v_)(f.formatCurrency(f.totals.costos)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,n.v_)(f.formatCurrency(f.totals.produccion)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,n.v_)(f.formatCurrency(f.totals.utilidad)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,n.v_)(f.totals.margen.toFixed(2))+"%",1)])])])])]))])}e(4114),e(8111),e(1701),e(8237);var L=e(144),_=e(782),D=e(1387),E=e(7682),P=e(1010),x=e(17),A=e(3408),w=e(3230),F=e(2125),V=e.n(F);x.t1.register(x.hE,x.m_,x.s$,x.E8,x.PP,x.kc,x.No,x.FN,A.A);var I={name:"ProductProfit",components:{Bar:P.yP},setup(){const a=(0,_.Pj)(),t=(0,D.rd)(),e=(0,L.KR)(null),n=(0,L.KR)([]),l=new Date,r=l.getMonth()+1,s=l.getFullYear(),d=(0,L.KR)(r),u=(0,L.KR)(""),i=(0,L.KR)([]),c=(0,L.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),p=(0,L.KR)(""),v=(0,L.KR)([]),h=(0,L.KR)([]),m=(0,o.EW)((()=>0===h.value.length)),y=(0,o.EW)((()=>{const a=h.value.reduce(((a,t)=>(a.ventas+=t.ventas,a.costos+=t.costos,a.produccion+=t.produccion,a.utilidad+=t.utilidad,a.margen+=t.margen*t.ventas,a)),{ventas:0,costos:0,produccion:0,utilidad:0,margen:0});return a.ventas>0&&(a.margen=a.margen/a.ventas),a})),b=(0,o.EW)((()=>h.value.length<=10?h.value:[...h.value].sort(((a,t)=>t.ventas-a.ventas)).slice(0,10))),g=()=>{if(!e.value||!d.value)return;const a={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};2!==d.value||e.value%4!==0||e.value%100===0&&e.value%400!==0||(a[2]=29);const t=a[d.value]||30;i.value=Array.from({length:t},((a,t)=>t+1)),u.value=""},k=async()=>{try{const a=await E.A.get("/available-years");n.value=a.data.years||[],n.value.length>0&&(e.value=n.value.includes(s)?s:n.value[0],g(),C(),f())}catch(a){console.error("Error fetching available years:",a),n.value=Array.from({length:5},((a,t)=>s+t-2)),e.value=s,g(),a.response&&401===a.response.status?t.push("/login"):(C(),f())}},C=async()=>{try{const a={year:e.value,month:d.value};u.value&&(a.day=u.value);const t=await E.A.get("/dashboard/sales-by-product",{params:a});v.value=t.data.products.map((a=>({descripcion:a})))||[]}catch(a){console.error("Error fetching products:",a),v.value=[]}},f=async()=>{if(e.value)try{const a={year:e.value,month:d.value};u.value&&(a.day=u.value),p.value&&(a.product_desc=p.value);const t=await E.A.get("/dashboard/product-profit",{params:a});h.value=t.data.data||[],console.log("Datos recibidos:",h.value)}catch(a){console.error("Error fetching product profit data:",a),h.value=[],a.response&&401===a.response.status&&t.push("/login")}},P=()=>{g(),C(),f()},x=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a),A=(0,o.EW)((()=>({labels:b.value.map((a=>a.descripcion)),datasets:[{label:"Margen de Utilidad (%)",data:b.value.map((a=>a.margen)),backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]}))),F=(0,o.EW)((()=>({responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Margen (%)"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){const t=b.value[a.dataIndex];return[`${a.dataset.label}: ${a.parsed.y.toFixed(2)}%`,`Utilidad: ${x(t.utilidad)}`]}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:13,weight:"bold"},formatter:function(a,t){const e=b.value[t.dataIndex];return`${a.toFixed(2)}%\n${x(e.utilidad)}`}}}}))),I=(0,o.EW)((()=>({labels:b.value.map((a=>a.descripcion)),datasets:[{type:"bar",label:"Ventas",data:b.value.map((a=>a.ventas)),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,yAxisID:"y",datalabels:{display:!!p.value,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return x(a)}}},{type:"bar",label:"Costos de Producción",data:b.value.map((a=>a.produccion)),backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1,yAxisID:"y",datalabels:{display:!!p.value,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return x(a)}}},{type:"bar",label:"Costos de Inventario",data:b.value.map((a=>a.costos)),backgroundColor:"rgba(255, 206, 86, 0.6)",borderColor:"rgba(255, 206, 86, 1)",borderWidth:1,yAxisID:"y",datalabels:{display:!!p.value,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return x(a)}}},{type:"line",label:"Utilidad (COP)",data:b.value.map((a=>a.utilidad)),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:2,fill:!1,tension:.1,yAxisID:"y1",datalabels:{display:!0,anchor:"end",align:"top",color:"#000",font:{size:11,weight:"bold"},formatter:function(a){return x(a)}}}]}))),U={responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Producto"}},y:{beginAtZero:!0,title:{display:!0,text:"Valor (COP)"},position:"left"},y1:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},position:"right",grid:{drawOnChartArea:!1},ticks:{callback:function(a){return x(a)}}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return a.dataset.type,`${a.dataset.label}: ${x(a.parsed.y)}`}}}}},$=()=>{const a=h.value.map((a=>({Producto:a.descripcion,"Cantidad Vendida":a.cantidad_vendida,Ventas:a.ventas,Costos:a.costos,"Producción":a.produccion,Utilidad:a.utilidad,"Margen (%)":a.margen})));a.push({Producto:"Total","Cantidad Vendida":"-",Ventas:y.value.ventas,Costos:y.value.costos,"Producción":y.value.produccion,Utilidad:y.value.utilidad,"Margen (%)":y.value.margen});const t=w.Wp.json_to_sheet(a),o=w.Wp.book_new();w.Wp.book_append_sheet(o,t,"Utilidad por Producto"),w._h(o,`Utilidad_por_Producto_${e.value}_${d.value}${u.value?`_Dia${u.value}`:""}.xlsx`)},W=async a=>{const t=document.getElementById(a),o=document.createElement("a");o.href=await V()(t).then((a=>a.toDataURL("image/png"))),o.download=`${a}_${e.value}_${d.value}${u.value?`_Dia${u.value}`:""}.png`,o.click()};return(0,o.sV)((()=>{a.state.auth.token?k():t.push("/login")})),{year:e,years:n,month:d,months:c,day:u,daysInMonth:i,selectedProduct:p,products:v,productProfitData:h,noData:m,totals:y,chartData:b,fetchData:f,updateDaysAndFetch:P,formatCurrency:x,barChartData:A,barChartOptions:F,salesVsCostsChartData:I,salesVsCostsChartOptions:U,exportToExcel:$,downloadChart:W}}},U=e(1241);const $=(0,U.A)(I,[["render",f],["__scopeId","data-v-a421da2a"]]);var W=$}}]);
//# sourceMappingURL=118.14f43625.js.map