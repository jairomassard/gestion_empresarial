"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[517],{517:function(a,e,t){t.r(e),t.d(e,{default:function(){return I}});var l=t(6768),o=t(4232),n=t(5130);const u={class:"daily-profit"},r={class:"filters"},s=["value"],i=["value"],d=["value"],c=["value"],v={key:0,class:"no-data-message"},m={key:1,class:"charts-container"},p={class:"chart-wrapper"},y={class:"chart-wrapper"},f={class:"pdv-selector"},h=["value"],b={key:2,class:"table-container"},C={class:"profit-table"},D={key:0,class:"total-row"};function k(a,e,t,k,g,P){const E=(0,l.g2)("Bar"),L=(0,l.g2)("Line");return(0,l.uX)(),(0,l.CE)("div",u,[(0,l.Lk)("h1",null,"Utilidad Diaria por PDV - "+(0,o.v_)(k.monthName)+" "+(0,o.v_)(k.year),1),(0,l.Lk)("div",r,[e[14]||(e[14]=(0,l.Lk)("label",null,"Año:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>k.year=a),onChange:e[1]||(e[1]=(...a)=>k.fetchData&&k.fetchData(...a))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.years,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,s)))),128))],544),[[n.u1,k.year]]),e[15]||(e[15]=(0,l.Lk)("label",null,"Mes:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>k.month=a),onChange:e[3]||(e[3]=(...a)=>k.updateDaysAndFetch&&k.updateDaysAndFetch(...a))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.months,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a.num,value:a.num},(0,o.v_)(a.name),9,i)))),128))],544),[[n.u1,k.month]]),e[16]||(e[16]=(0,l.Lk)("label",null,"Estatus PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>k.status=a),onChange:e[5]||(e[5]=(...a)=>k.fetchData&&k.fetchData(...a))},e[11]||(e[11]=[(0,l.Lk)("option",{value:"Todos"},"Todos",-1),(0,l.Lk)("option",{value:"Activo"},"Activo",-1),(0,l.Lk)("option",{value:"Inactivo"},"Inactivo",-1)]),544),[[n.u1,k.status]]),e[17]||(e[17]=(0,l.Lk)("label",null,"PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>k.selectedPDV=a),onChange:e[7]||(e[7]=(...a)=>k.fetchData&&k.fetchData(...a))},[e[12]||(e[12]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.pdvs,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,d)))),128))],544),[[n.u1,k.selectedPDV]]),e[18]||(e[18]=(0,l.Lk)("label",null,"Día:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>k.selectedDay=a),onChange:e[9]||(e[9]=(...a)=>k.fetchData&&k.fetchData(...a))},[e[13]||(e[13]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.daysInMonth,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,c)))),128))],544),[[n.u1,k.selectedDay]])]),k.noData?((0,l.uX)(),(0,l.CE)("div",v,(0,o.v_)(k.noDataMessage),1)):(0,l.Q3)("",!0),k.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("div",p,[e[19]||(e[19]=(0,l.Lk)("h2",null,"Utilidad Total por PDV",-1)),(0,l.bF)(E,{data:k.barChartData,options:k.barChartOptions},null,8,["data","options"])]),(0,l.Lk)("div",y,[e[22]||(e[22]=(0,l.Lk)("h2",null,"Tendencia de Utilidad Diaria",-1)),(0,l.Lk)("div",f,[e[21]||(e[21]=(0,l.Lk)("label",null,"Seleccionar PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>k.selectedPdv=a)},[e[20]||(e[20]=(0,l.Lk)("option",{value:"total"},"Total (Todos los PDVs)",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,h)))),128))],512),[[n.u1,k.selectedPdv]])]),(0,l.bF)(L,{data:k.lineChartData,options:k.lineChartOptions},null,8,["data","options"])])])),k.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",b,[(0,l.Lk)("table",C,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[e[23]||(e[23]=(0,l.Lk)("th",null,"Fecha",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a},(0,o.v_)(a),1)))),128)),e[24]||(e[24]=(0,l.Lk)("th",null,"Total",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.filteredDailyProfitData,(a=>((0,l.uX)(),(0,l.CE)("tr",{key:a.date},[(0,l.Lk)("td",null,(0,o.v_)(a.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.filteredPdvs,(e=>((0,l.uX)(),(0,l.CE)("td",{key:e},(0,o.v_)(a[e]?k.formatCurrency(a[e].utilidad):"-"),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(k.formatCurrency(a.total.utilidad)),1)])))),128)),k.filteredDailyProfitData.length>0?((0,l.uX)(),(0,l.CE)("tr",D,[(0,l.Lk)("td",null,(0,o.v_)(k.filteredTotals.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("td",{key:a},(0,o.v_)(k.filteredTotals[a]?k.formatCurrency(k.filteredTotals[a].utilidad):"-"),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(k.formatCurrency(k.filteredTotals.total.utilidad)),1)])):(0,l.Q3)("",!0)])])]))])}t(4114),t(8111),t(1148),t(2489),t(116),t(7588),t(1701),t(8237),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);var g=t(144),P=t(782),E=t(1387),L=t(7682),F=t(1010),T=t(17),K=t(3408);t(8422);T.t1.register(T.hE,T.m_,T.s$,T.E8,T.No,T.FN,T.PP,T.kc,T.UA,K.A);var O={name:"DailyProfit",components:{Bar:F.yP,Line:F.N1},setup(){const a=(0,P.Pj)(),e=(0,E.rd)(),t=(0,g.KR)(null),o=(0,g.KR)([]),n=new Date,u=n.getMonth()+1,r=n.getFullYear(),s=(0,g.KR)(u),i=(0,g.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),d=(0,g.KR)("Activo"),c=(0,g.KR)("Todos"),v=(0,g.KR)("Todos"),m=(0,g.KR)([]),p=(0,g.KR)([]),y=(0,g.KR)([]),f=(0,g.KR)([]),h=(0,g.KR)([]),b=(0,g.KR)({}),C=(0,g.KR)({}),D=(0,g.KR)("total"),k=(0,l.EW)((()=>{const a=i.value.find((a=>a.num===s.value));return a?a.name:"Mes"})),F=(0,l.EW)((()=>{const a=0===y.value.length||y.value.every((a=>!a.total||0===a.total.utilidad));return console.log("noData:",a,"filteredDailyProfitData:",y.value),a})),T=(0,l.EW)((()=>"Todos"!==v.value?`No hay datos disponibles para el ${v.value} de ${k.value} ${t.value}.`:`No hay datos disponibles para ${k.value} ${t.value} con los filtros seleccionados.`)),K=()=>{if(!t.value||!s.value)return;console.log("Actualizando días para:",{year:t.value,month:s.value});const a={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};2!==s.value||t.value%4!==0||t.value%100===0&&t.value%400!==0||(a[2]=29);const e=a[s.value]||30;m.value=Array.from({length:e},((a,e)=>e+1)),v.value="Todos"},O=()=>{K(),X()},A=async()=>{try{const a=await L.A.get("/available-years");o.value=a.data.years||[],o.value.length>0&&(t.value=o.value.includes(r)?r:o.value[0],K(),X())}catch(a){console.error("Error fetching available years:",a),o.value=Array.from({length:5},((a,e)=>r+e-2)),t.value=r,K(),X()}},X=async()=>{if(t.value)try{const a={year:t.value,month:s.value,status:d.value};"Todos"!==c.value&&(a.pdv=c.value),"Todos"!==v.value&&(a.day=v.value),console.log("Solicitando datos con parámetros:",a);const e=await L.A.get("/dashboard/daily-profit",{params:a});p.value=e.data.data||[],f.value=e.data.pdvs||[],b.value=e.data.totals||{},I(),console.log("Datos recibidos:",{dailyProfitData:p.value,pdvs:f.value,totals:b.value})}catch(a){console.error("Error fetching daily profit data:",a),p.value=[],f.value=[],b.value={},y.value=[],h.value=[],C.value={},a.response&&401===a.response.status&&e.push("/login")}},I=()=>{console.log("Actualizando datos filtrados, selectedDay:",v.value);const a=new Set;if(p.value.forEach((e=>{Object.keys(e).forEach((e=>{"date"!==e&&"total"!==e&&f.value.includes(e)&&a.add(e)}))})),"Todos"===c.value?h.value=f.value.filter((e=>a.has(e))):h.value=f.value.filter((e=>e===c.value&&a.has(e))),"Todos"===v.value)y.value=p.value;else{const a=v.value.toString().padStart(2,"0"),e=s.value.toString().padStart(2,"0"),l=`${a}/${e}/${t.value}`;y.value=p.value.filter((a=>{const e=a.date.includes(", ")?a.date.split(", ")[1]:a.date;return e.includes(l)})),console.log("Filtrando por día:",{datePattern:l,filteredData:y.value})}C.value={date:"TOTALES"},h.value.forEach((a=>{C.value[a]={ventas:y.value.reduce(((e,t)=>e+(t[a]?.ventas||0)),0),costos:y.value.reduce(((e,t)=>e+(t[a]?.costos||0)),0),produccion:y.value.reduce(((e,t)=>e+(t[a]?.produccion||0)),0),utilidad:y.value.reduce(((e,t)=>e+(t[a]?.utilidad||0)),0)}})),C.value.total={ventas:y.value.reduce(((a,e)=>a+(e.total?.ventas||0)),0),costos:y.value.reduce(((a,e)=>a+(e.total?.costos||0)),0),produccion:y.value.reduce(((a,e)=>a+(e.total?.produccion||0)),0),utilidad:y.value.reduce(((a,e)=>a+(e.total?.utilidad||0)),0)}},w=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a),V=(0,l.EW)((()=>{const a={labels:h.value,datasets:[{label:"Utilidad Total (COP)",data:h.value.map((a=>C.value[a]?.utilidad||0)),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]};return console.log("barChartData:",a),a})),_={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(a){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a)}}},x:{title:{display:!0,text:"Punto de Venta"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){let e=a.dataset.label||"";return e&&(e+=": "),e+=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a.parsed.y),e}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a)}}}},R=(0,l.EW)((()=>{const a=y.value.map((a=>{const e=a.date.includes(", ")?a.date.split(", ")[1]:a.date,[t,l,o]=e.split("/");return`${o}-${l}-${t}`}));let e;e="total"===D.value?y.value.map((a=>a.total.utilidad)):y.value.map((a=>a[D.value]?.utilidad||0));const t={labels:a,datasets:[{label:"total"===D.value?"Utilidad Total (COP)":`Utilidad de ${D.value} (COP)`,data:e,fill:!1,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",tension:.1}]};return console.log("lineChartData:",t),t})),M={responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"dd/MM/yyyy",displayFormats:{day:"dd/MM/yyyy"}},title:{display:!0,text:"Fecha"}},y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(a){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a)}}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){let e=a.dataset.label||"";return e&&(e+=": "),e+=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a.parsed.y),e}}},datalabels:{display:!1}}};return(0,l.sV)((()=>{console.log("Montando componente, estado inicial:",{month:s.value,months:i.value}),a.state.auth.token?A():e.push("/login")})),(0,l.wB)(D,(()=>{console.log("PDV seleccionado cambiado a:",D.value)})),(0,l.wB)(s,(a=>{console.log("Month cambiado a:",a)})),(0,l.wB)(v,(a=>{console.log("Día seleccionado cambiado a:",a)})),{year:t,years:o,month:s,months:i,monthName:k,status:d,selectedPDV:c,selectedDay:v,daysInMonth:m,dailyProfitData:p,filteredDailyProfitData:y,pdvs:f,filteredPdvs:h,totals:b,filteredTotals:C,noData:F,noDataMessage:T,selectedPdv:D,barChartData:V,barChartOptions:_,lineChartData:R,lineChartOptions:M,fetchData:X,updateDaysAndFetch:O,formatCurrency:w}}},A=t(1241);const X=(0,A.A)(O,[["render",k],["__scopeId","data-v-6920b4c9"]]);var I=X}}]);
//# sourceMappingURL=517.47563d0a.js.map