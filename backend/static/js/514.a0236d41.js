"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[514],{5514:function(a,e,t){t.r(e),t.d(e,{default:function(){return F}});var n=t(6768),o=t(4232),r=t(5130);const l={class:"product-profit"},u={class:"filters"},s=["value"],c=["value"],d=["value"],i={key:0,class:"no-data-message"},p={key:1,class:"charts-container"},m={class:"chart-wrapper"},h={key:2,class:"table-container"},v={class:"profit-table"};function y(a,e,t,y,b,k){const f=(0,n.g2)("Bar");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("h1",null,"Margen de Utilidad por Producto - "+(0,o.v_)(y.months[y.month-1].name)+" "+(0,o.v_)(y.year),1),(0,n.Lk)("div",u,[e[7]||(e[7]=(0,n.Lk)("label",null,"Año:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>y.year=a),onChange:e[1]||(e[1]=(...a)=>y.fetchData&&y.fetchData(...a))},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.years,(a=>((0,n.uX)(),(0,n.CE)("option",{key:a,value:a},(0,o.v_)(a),9,s)))),128))],544),[[r.u1,y.year]]),e[8]||(e[8]=(0,n.Lk)("label",null,"Mes:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.month=a),onChange:e[3]||(e[3]=(...a)=>y.fetchData&&y.fetchData(...a))},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.months,(a=>((0,n.uX)(),(0,n.CE)("option",{key:a.num,value:a.num},(0,o.v_)(a.name),9,c)))),128))],544),[[r.u1,y.month]]),e[9]||(e[9]=(0,n.Lk)("label",null,"Producto:",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.selectedProduct=a),onChange:e[5]||(e[5]=(...a)=>y.fetchData&&y.fetchData(...a))},[e[6]||(e[6]=(0,n.Lk)("option",{value:""},"Todos",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.products,(a=>((0,n.uX)(),(0,n.CE)("option",{key:a.descripcion,value:a.descripcion},(0,o.v_)(a.descripcion),9,d)))),128))],544),[[r.u1,y.selectedProduct]])]),y.noData?((0,n.uX)(),(0,n.CE)("div",i," No hay datos disponibles para el mes, año y filtros seleccionados. ")):(0,n.Q3)("",!0),y.noData?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("div",m,[e[10]||(e[10]=(0,n.Lk)("h2",null,"Margen de Utilidad por Producto",-1)),(0,n.bF)(f,{data:y.barChartData,options:y.barChartOptions},null,8,["data","options"])])])),y.noData?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",h,[(0,n.Lk)("table",v,[e[11]||(e[11]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Producto"),(0,n.Lk)("th",null,"Cantidad Vendida"),(0,n.Lk)("th",null,"Ventas"),(0,n.Lk)("th",null,"Costos"),(0,n.Lk)("th",null,"Producción"),(0,n.Lk)("th",null,"Utilidad"),(0,n.Lk)("th",null,"Margen (%)")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.productProfitData,(a=>((0,n.uX)(),(0,n.CE)("tr",{key:a.descripcion},[(0,n.Lk)("td",null,(0,o.v_)(a.descripcion),1),(0,n.Lk)("td",null,(0,o.v_)(a.cantidad_vendida.toFixed(2)),1),(0,n.Lk)("td",null,(0,o.v_)(y.formatCurrency(a.ventas)),1),(0,n.Lk)("td",null,(0,o.v_)(y.formatCurrency(a.costos)),1),(0,n.Lk)("td",null,(0,o.v_)(y.formatCurrency(a.produccion)),1),(0,n.Lk)("td",null,(0,o.v_)(y.formatCurrency(a.utilidad)),1),(0,n.Lk)("td",null,(0,o.v_)(a.margen.toFixed(2))+"%",1)])))),128))])])]))])}t(4114),t(8111),t(1701);var b=t(144),k=t(782),f=t(1387),g=t(7682),C=t(1010),L=t(17),E=t(3408);L.t1.register(L.hE,L.m_,L.s$,L.E8,L.PP,L.kc,E.A);var D={name:"ProductProfit",components:{Bar:C.yP},setup(){const a=(0,k.Pj)(),e=(0,f.rd)(),t=(0,b.KR)(null),o=(0,b.KR)([]),r=new Date,l=r.getMonth()+1,u=r.getFullYear(),s=(0,b.KR)(l),c=(0,b.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),d=(0,b.KR)(""),i=(0,b.KR)([]),p=(0,b.KR)([]),m=(0,n.EW)((()=>0===p.value.length)),h=async()=>{try{const a=await g.A.get("/available-years");o.value=a.data.years||[],o.value.length>0&&(t.value=o.value.includes(u)?u:o.value[0],v(),y())}catch(a){console.error("Error fetching available years:",a),o.value=Array.from({length:5},((a,e)=>u+e-2)),t.value=u,a.response&&401===a.response.status?e.push("/login"):(v(),y())}},v=async()=>{try{const a={year:t.value,month:s.value},e=await g.A.get("/dashboard/sales-by-product",{params:a});i.value=e.data.products.map((a=>({descripcion:a})))||[]}catch(a){console.error("Error fetching products:",a),i.value=[]}},y=async()=>{if(t.value)try{const a={year:t.value,month:s.value};d.value&&(a.product_desc=d.value);const e=await g.A.get("/dashboard/product-profit",{params:a});p.value=e.data.data||[],console.log("Datos recibidos:",p.value)}catch(a){console.error("Error fetching product profit data:",a),p.value=[],a.response&&401===a.response.status&&e.push("/login")}},C=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a),L=(0,n.EW)((()=>{const a={labels:p.value.map((a=>a.descripcion)),datasets:[{label:"Margen de Utilidad (%)",data:p.value.map((a=>a.margen)),backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]};return a})),E={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Margen (%)"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${a.parsed.y.toFixed(2)}%`}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return`${a.toFixed(2)}%`}}}};return(0,n.sV)((()=>{a.state.auth.token?h():e.push("/login")})),{year:t,years:o,month:s,months:c,selectedProduct:d,products:i,productProfitData:p,noData:m,fetchData:y,formatCurrency:C,barChartData:L,barChartOptions:E}}},P=t(1241);const _=(0,P.A)(D,[["render",y],["__scopeId","data-v-1623ac1c"]]);var F=_}}]);
//# sourceMappingURL=514.a0236d41.js.map