"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[178],{8178:function(a,t,e){e.r(t),e.d(t,{default:function(){return M}});var o=e(6768),l=e(4232),n=e(5130);const r={class:"product-profit"},s={key:0},d={class:"filters"},u=["value"],i=["value"],c=["value"],p=["value"],v={class:"actions"},h={key:0,class:"no-data-message"},m={key:1,class:"charts-container"},b={class:"chart-wrapper"},C={class:"chart-wrapper"},g={class:"chart-wrapper"},k={key:2,class:"table-container"},y={class:"profit-table"},f={class:"total-row"};function L(a,t,e,L,_,E){const P=(0,o.g2)("Bar");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("h1",null,[(0,o.eW)("Margen de Utilidad por Producto - "+(0,l.v_)(L.months[L.month-1].name)+" "+(0,l.v_)(L.year)+" ",1),L.day?((0,o.uX)(),(0,o.CE)("span",s," (Día "+(0,l.v_)(L.day)+")",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",d,[t[13]||(t[13]=(0,o.Lk)("label",null,"Año:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>L.year=a),onChange:t[1]||(t[1]=(...a)=>L.fetchData&&L.fetchData(...a))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.years,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a,value:a},(0,l.v_)(a),9,u)))),128))],544),[[n.u1,L.year]]),t[14]||(t[14]=(0,o.Lk)("label",null,"Mes:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>L.month=a),onChange:t[3]||(t[3]=(...a)=>L.onMonthChange&&L.onMonthChange(...a))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.months,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a.num,value:a.num},(0,l.v_)(a.name),9,i)))),128))],544),[[n.u1,L.month]]),t[15]||(t[15]=(0,o.Lk)("label",null,"Día:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>L.day=a),onChange:t[5]||(t[5]=(...a)=>L.fetchData&&L.fetchData(...a))},[t[11]||(t[11]=(0,o.Lk)("option",{value:""},"Todos",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.dayscfafterdays,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a,value:a},(0,l.v_)(a),9,c)))),128))],544),[[n.u1,L.day]]),t[16]||(t[16]=(0,o.Lk)("label",null,"Producto:",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>L.selectedProduct=a),onChange:t[7]||(t[7]=(...a)=>L.fetchData&&L.fetchData(...a))},[t[12]||(t[12]=(0,o.Lk)("option",{value:""},"Todos",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.products,(a=>((0,o.uX)(),(0,o.CE)("option",{key:a.descripcion,value:a.descripcion},(0,l.v_)(a.descripcion),9,p)))),128))],544),[[n.u1,L.selectedProduct]])]),(0,o.Lk)("div",v,[(0,o.Lk)("button",{onClick:t[8]||(t[8]=(...a)=>L.exportToExcel&&L.exportToExcel(...a))},"Exportar a Excel"),(0,o.Lk)("button",{onClick:t[9]||(t[9]=a=>L.downloadChart("profitChart"))},"Descargar Gráfico de Utilidad"),(0,o.Lk)("button",{onClick:t[10]||(t[10]=a=>L.downloadChart("salesVsCostsChart"))},"Descargar Gráfico de Ventas vs Costos")]),L.noData?((0,o.uX)(),(0,o.CE)("div",h," No hay datos disponibles para el mes, año, día y filtros seleccionados. ")):(0,o.Q3)("",!0),L.noData?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",m,[(0,o.Lk)("div",b,[t[17]||(t[17]=(0,o.Lk)("h2",null,"Margen de Utilidad por Producto",-1)),(0,o.bF)(P,{id:"profitChart",data:L.barChartData,options:L.barChartOptions},null,8,["data","options"])]),(0,o.Lk)("div",C,[t[18]||(t[18]=(0,o.Lk)("h2",null,"Utilidad en Pesos (COP)",-1)),(0,o.bF)(P,{id:"utilityChart",data:L.utilityChartData,options:L.utilityChartOptions},null,8,["data","options"])]),(0,o.Lk)("div",g,[t[19]||(t[19]=(0,o.Lk)("h2",null,"Ventas vs Costos de Producción vs Costos de Inventario",-1)),(0,o.bF)(P,{id:"salesVsCostsChart",data:L.salesVsCostsChartData,options:L.salesVsCostsChartOptions},null,8,["data","options"])])])),L.noData?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("table",y,[t[21]||(t[21]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Producto"),(0,o.Lk)("th",null,"Cantidad Vendida"),(0,o.Lk)("th",null,"Ventas"),(0,o.Lk)("th",null,"Costos"),(0,o.Lk)("th",null,"Producción"),(0,o.Lk)("th",null,"Utilidad"),(0,o.Lk)("th",null,"Margen (%)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.productProfitData,(a=>((0,o.uX)(),(0,o.CE)("tr",{key:a.descripcion},[(0,o.Lk)("td",null,(0,l.v_)(a.descripcion),1),(0,o.Lk)("td",null,(0,l.v_)(a.cantidad_vendida.toFixed(2)),1),(0,o.Lk)("td",null,(0,l.v_)(L.formatCurrency(a.ventas)),1),(0,o.Lk)("td",null,(0,l.v_)(L.formatCurrency(a.costos)),1),(0,o.Lk)("td",null,(0,l.v_)(L.formatCurrency(a.produccion)),1),(0,o.Lk)("td",null,(0,l.v_)(L.formatCurrency(a.utilidad)),1),(0,o.Lk)("td",null,(0,l.v_)(a.margen.toFixed(2))+"%",1)])))),128)),(0,o.Lk)("tr",f,[t[20]||(t[20]=(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,"Total")],-1)),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.totals.cantidad_vendida.toFixed(2)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.formatCurrency(L.totals.ventas)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.formatCurrency(L.totals.costos)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.formatCurrency(L.totals.produccion)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.formatCurrency(L.totals.utilidad)),1)]),(0,o.Lk)("td",null,[(0,o.Lk)("strong",null,(0,l.v_)(L.totals.margen.toFixed(2))+"%",1)])])])])]))])}e(4114),e(8111),e(1701),e(8237);var _=e(144),E=e(782),P=e(1387),D=e(7682),x=e(1010),V=e(17),w=e(3408),F=e(3230),U=e(2125),$=e.n(U);V.t1.register(V.hE,V.m_,V.s$,V.E8,V.PP,V.kc,w.A);var A={name:"ProductProfit",components:{Bar:x.yP},setup(){const a=(0,E.Pj)(),t=(0,P.rd)(),e=(0,_.KR)(null),l=(0,_.KR)([]),n=new Date,r=n.getMonth()+1,s=n.getFullYear(),d=(0,_.KR)(r),u=(0,_.KR)(""),i=(0,_.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),c=(0,o.EW)((()=>{if(!e.value||!d.value)return[];const a=new Date(e.value,d.value,0).getDate();return Array.from({length:a},((a,t)=>t+1))})),p=(0,_.KR)(""),v=(0,_.KR)([]),h=(0,_.KR)([]),m=(0,o.EW)((()=>0===h.value.length)),b=(0,o.EW)((()=>h.value.reduce(((a,t)=>(a.cantidad_vendida+=t.cantidad_vendida,a.ventas+=t.ventas,a.costos+=t.costos,a.produccion+=t.produccion,a.utilidad+=t.utilidad,a.margen+=t.margen*t.ventas,a)),{cantidad_vendida:0,ventas:0,costos:0,produccion:0,utilidad:0,margen:0})));(0,o.EW)((()=>(b.value.ventas>0&&(b.value.margen=b.value.margen/b.value.ventas),b.value)));const C=async()=>{try{const a=await D.A.get("/available-years");l.value=a.data.years||[],l.value.length>0&&(e.value=l.value.includes(s)?s:l.value[0],g(),k())}catch(a){console.error("Error fetching available years:",a),l.value=Array.from({length:5},((a,t)=>s+t-2)),e.value=s,a.response&&401===a.response.status?t.push("/login"):(g(),k())}},g=async()=>{try{const a={year:e.value,month:d.value};u.value&&(a.day=u.value);const t=await D.A.get("/dashboard/sales-by-product",{params:a});v.value=t.data.products.map((a=>({descripcion:a})))||[]}catch(a){console.error("Error fetching products:",a),v.value=[]}},k=async()=>{if(e.value)try{const a={year:e.value,month:d.value};u.value&&(a.day=u.value),p.value&&(a.product_desc=p.value);const t=await D.A.get("/dashboard/product-profit",{params:a});h.value=t.data.data||[],console.log("Datos recibidos:",h.value)}catch(a){console.error("Error fetching product profit data:",a),h.value=[],a.response&&401===a.response.status&&t.push("/login")}},y=()=>{u.value="",g(),k()},f=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a),L=(0,o.EW)((()=>({labels:h.value.map((a=>a.descripcion)),datasets:[{label:"Margen de Utilidad (%)",data:h.value.map((a=>a.margen)),backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]}))),x={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Margen (%)"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${a.parsed.y.toFixed(2)}%`}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return`${a.toFixed(2)}%`}}}},V=(0,o.EW)((()=>({labels:h.value.map((a=>a.descripcion)),datasets:[{label:"Utilidad (COP)",data:h.value.map((a=>a.utilidad)),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]}))),w={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${f(a.parsed.y)}`}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:11,weight:"bold"},formatter:function(a){return f(a)}}}},U=(0,o.EW)((()=>({labels:h.value.map((a=>a.descripcion)),datasets:[{label:"Ventas",data:h.value.map((a=>a.ventas)),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Costos de Producción",data:h.value.map((a=>a.produccion)),backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1},{label:"Costos de Inventario",data:h.value.map((a=>a.costos)),backgroundColor:"rgba(255, 206, 86, 0.6)",borderColor:"rgba(255, 206, 86, 1)",borderWidth:1}]}))),A={responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1,title:{display:!0,text:"Producto"}},y:{stacked:!1,beginAtZero:!0,title:{display:!0,text:"Valor (COP)"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${f(a.parsed.y)}`}}},datalabels:{display:!1}}},W=()=>{const a=h.value.map((a=>({Producto:a.descripcion,"Cantidad Vendida":a.cantidad_vendida,Ventas:a.ventas,Costos:a.costos,"Producción":a.produccion,Utilidad:a.utilidad,"Margen (%)":a.margen})));a.push({Producto:"Total","Cantidad Vendida":b.value.cantidad_vendida,Ventas:b.value.ventas,Costos:b.value.costos,"Producción":b.value.produccion,Utilidad:b.value.utilidad,"Margen (%)":b.value.margen});const t=F.Wp.json_to_sheet(a),o=F.Wp.book_new();F.Wp.book_append_sheet(o,t,"Utilidad por Producto"),F._h(o,`Utilidad_por_Producto_${e.value}_${d.value}${u.value?`_Dia${u.value}`:""}.xlsx`)},X=async a=>{const t=document.getElementById(a),o=document.createElement("a");o.href=await $()(t).then((a=>a.toDataURL("image/png"))),o.download=`${a}_${e.value}_${d.value}${u.value?`_Dia${u.value}`:""}.png`,o.click()};return(0,o.sV)((()=>{a.state.auth.token?C():t.push("/login")})),{year:e,years:l,month:d,months:i,day:u,days:c,selectedProduct:p,products:v,productProfitData:h,noData:m,totals:b,fetchData:k,onMonthChange:y,formatCurrency:f,barChartData:L,barChartOptions:x,utilityChartData:V,utilityChartOptions:w,salesVsCostsChartData:U,salesVsCostsChartOptions:A,exportToExcel:W,downloadChart:X}}},W=e(1241);const X=(0,W.A)(A,[["render",L],["__scopeId","data-v-004684ee"]]);var M=X}}]);
//# sourceMappingURL=178.0d0bee26.js.map