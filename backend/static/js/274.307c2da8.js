"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[274],{7274:function(o,t,a){a.r(t),a.d(t,{default:function(){return j}});var e=a(6768),s=a(5130),i=a(4232);const l={class:"kardex-view"},r={class:"actions",style:{"justify-content":"flex-end"}},c={class:"filters form-section"},n={class:"filters-header"},d={class:"form-group"},u={class:"form-group"},h={class:"form-actions"},m={class:"filters-products form-group"},p={class:"filters-products form-group"},g=["value"],k={class:"filters-products form-group"},f={key:0,class:"summary form-section"},b={class:"cpp-global"},L={class:"table-container"},C={class:"resumen-costos"},A={class:"total-row"},_={key:1,class:"filters-bodega form-section"},P={class:"bodega-checkboxes"},x={class:"checkbox-container"},v=["value"],S={key:2,class:"results form-section"},F={class:"form-actions"},$={class:"table-container"},N={key:3,class:"form-section"};function y(o,t,a,y,D,I){const E=(0,e.g2)("font-awesome-icon");return(0,e.uX)(),(0,e.CE)("div",l,[t[34]||(t[34]=(0,e.Lk)("h1",null,"Kardex de Inventario de Productos",-1)),(0,e.Lk)("div",r,[(0,e.Lk)("button",{onClick:t[0]||(t[0]=(...o)=>I.limpiarPagina&&I.limpiarPagina(...o)),class:"btn btn-warning"},"Limpiar Página")]),(0,e.Lk)("section",c,[t[23]||(t[23]=(0,e.Lk)("h2",null,"Filtrar Movimientos",-1)),(0,e.Lk)("div",n,[(0,e.Lk)("div",d,[t[17]||(t[17]=(0,e.Lk)("label",{for:"fechaInicio"},"Fecha inicio:",-1)),(0,e.bo)((0,e.Lk)("input",{type:"date",id:"fechaInicio","onUpdate:modelValue":t[1]||(t[1]=o=>D.fechaInicio=o)},null,512),[[s.Jo,D.fechaInicio]])]),(0,e.Lk)("div",u,[t[18]||(t[18]=(0,e.Lk)("label",{for:"fechaFin"},"Fecha fin:",-1)),(0,e.bo)((0,e.Lk)("input",{type:"date",id:"fechaFin","onUpdate:modelValue":t[2]||(t[2]=o=>D.fechaFin=o)},null,512),[[s.Jo,D.fechaFin]])]),(0,e.Lk)("div",h,[(0,e.Lk)("button",{onClick:t[3]||(t[3]=(...o)=>I.consultarKardex&&I.consultarKardex(...o)),class:"btn"},"Consultar Kardex")])]),(0,e.Lk)("div",m,[t[19]||(t[19]=(0,e.Lk)("label",{for:"nombreProducto"},"Buscar por nombre:",-1)),(0,e.bo)((0,e.Lk)("input",{type:"text",id:"nombreProducto","onUpdate:modelValue":t[4]||(t[4]=o=>D.nombreProducto=o),placeholder:"Ingrese nombre del producto",onInput:t[5]||(t[5]=(...o)=>I.sincronizarPorNombre&&I.sincronizarPorNombre(...o))},null,544),[[s.Jo,D.nombreProducto]])]),(0,e.Lk)("div",p,[t[21]||(t[21]=(0,e.Lk)("label",{for:"productoSelector"},"Seleccione un producto:",-1)),(0,e.bo)((0,e.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>D.codigoProducto=o),id:"productoSelector",onChange:t[7]||(t[7]=(...o)=>I.sincronizarSelectorConCodigo&&I.sincronizarSelectorConCodigo(...o))},[t[20]||(t[20]=(0,e.Lk)("option",{value:"",disabled:""},"Seleccione un producto",-1)),((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(D.productos,(o=>((0,e.uX)(),(0,e.CE)("option",{key:o.codigo,value:o.codigo},(0,i.v_)(o.codigo)+" - "+(0,i.v_)(o.nombre),9,g)))),128))],544),[[s.u1,D.codigoProducto]])]),(0,e.Lk)("div",k,[t[22]||(t[22]=(0,e.Lk)("label",{for:"codigoProducto"},"O ingrese el código del producto:",-1)),(0,e.bo)((0,e.Lk)("input",{type:"text",id:"codigoProducto","onUpdate:modelValue":t[8]||(t[8]=o=>D.codigoProducto=o),placeholder:"Ingrese el código del producto",onInput:t[9]||(t[9]=(...o)=>I.sincronizarCodigoConSelector&&I.sincronizarCodigoConSelector(...o))},null,544),[[s.Jo,D.codigoProducto]])])]),t[35]||(t[35]=(0,e.Lk)("p",{class:"info-message"}," Nota: Para incluir movimientos del día actual, seleccione un día adicional como fecha final. ",-1)),D.kardex.length?((0,e.uX)(),(0,e.CE)("section",f,[t[28]||(t[28]=(0,e.Lk)("h2",null,"Resumen por Almacén",-1)),(0,e.Lk)("div",b,[t[24]||(t[24]=(0,e.Lk)("span",null,"CPP GLOBAL",-1)),(0,e.Lk)("span",null,(0,i.v_)(D.cppGlobal?`$${I.formatCosto(D.cppGlobal)}`:"N/A"),1)]),(0,e.Lk)("div",L,[(0,e.Lk)("table",C,[t[27]||(t[27]=(0,e.Lk)("thead",null,[(0,e.Lk)("tr",null,[(0,e.Lk)("th",null,"ALMACÉN"),(0,e.Lk)("th",null,"STOCK FINAL"),(0,e.Lk)("th",null,"VALOR ACUMULADO"),(0,e.Lk)("th",null,"CPP")])],-1)),(0,e.Lk)("tbody",null,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(D.resumenPorAlmacen,((o,t)=>((0,e.uX)(),(0,e.CE)("tr",{key:t},[(0,e.Lk)("td",null,(0,i.v_)(o.almacen),1),(0,e.Lk)("td",null,(0,i.v_)(I.formatCosto(o.stockFinal)),1),(0,e.Lk)("td",null,(0,i.v_)(null!==o.valorAcumulado&&void 0!==o.valorAcumulado?`$${I.formatCosto(o.valorAcumulado)}`:"$0.00"),1),(0,e.Lk)("td",null,(0,i.v_)(null!==o.cpp&&void 0!==o.cpp&&o.stockFinal>0?`$${I.formatCosto(o.cpp)}`:"N/A"),1)])))),128)),(0,e.Lk)("tr",A,[t[25]||(t[25]=(0,e.Lk)("td",null,[(0,e.Lk)("strong",null,"TOTAL")],-1)),(0,e.Lk)("td",null,[(0,e.Lk)("strong",null,(0,i.v_)(I.formatCosto(D.totalStock)),1)]),(0,e.Lk)("td",null,[(0,e.Lk)("strong",null,(0,i.v_)(D.totalValor?`$${I.formatCosto(D.totalValor)}`:"N/A"),1)]),t[26]||(t[26]=(0,e.Lk)("td",null,null,-1))])])])])])):(0,e.Q3)("",!0),D.kardex.length?((0,e.uX)(),(0,e.CE)("section",_,[t[30]||(t[30]=(0,e.Lk)("h3",null,"Filtrar por Almacén",-1)),(0,e.Lk)("div",P,[(0,e.Lk)("label",x,[(0,e.bo)((0,e.Lk)("input",{type:"checkbox",value:"","onUpdate:modelValue":t[10]||(t[10]=o=>D.bodegasSeleccionadas=o),onChange:t[11]||(t[11]=(...o)=>I.filtrarPorBodega&&I.filtrarPorBodega(...o))},null,544),[[s.lH,D.bodegasSeleccionadas]]),t[29]||(t[29]=(0,e.Lk)("span",null,"Todos",-1))]),((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(D.bodegas,(o=>((0,e.uX)(),(0,e.CE)("label",{key:o.id,class:"checkbox-container"},[(0,e.bo)((0,e.Lk)("input",{type:"checkbox",value:o.nombre,"onUpdate:modelValue":t[12]||(t[12]=o=>D.bodegasSeleccionadas=o),onChange:t[13]||(t[13]=(...o)=>I.filtrarPorBodega&&I.filtrarPorBodega(...o))},null,40,v),[[s.lH,D.bodegasSeleccionadas]]),(0,e.Lk)("span",null,(0,i.v_)(o.nombre),1)])))),128))])])):(0,e.Q3)("",!0),D.kardexFiltrado.length?((0,e.uX)(),(0,e.CE)("section",S,[t[32]||(t[32]=(0,e.Lk)("h2",null,"Movimientos del Producto",-1)),(0,e.Lk)("div",F,[(0,e.Lk)("button",{onClick:t[14]||(t[14]=(...o)=>I.imprimirKardexPDF&&I.imprimirKardexPDF(...o)),class:"btn btn-success",title:"Imprimir PDF"},[(0,e.bF)(E,{icon:"file-pdf",class:"pdf-icon"})]),(0,e.Lk)("button",{onClick:t[15]||(t[15]=(...o)=>I.exportarKardexCSV&&I.exportarKardexCSV(...o)),class:"btn btn-info",title:"Exportar CSV"},[(0,e.bF)(E,{icon:"file-csv",class:"csv-icon"})]),(0,e.Lk)("button",{onClick:t[16]||(t[16]=(...o)=>I.exportarKardexExcel&&I.exportarKardexExcel(...o)),class:"btn btn-primary",title:"Exportar Excel"},[(0,e.bF)(E,{icon:"file-excel",class:"excel-icon"})])]),(0,e.Lk)("div",$,[(0,e.Lk)("table",null,[t[31]||(t[31]=(0,e.Lk)("thead",null,[(0,e.Lk)("tr",null,[(0,e.Lk)("th",null,"Fecha"),(0,e.Lk)("th",null,"Documento"),(0,e.Lk)("th",null,"Almacén"),(0,e.Lk)("th",null,"Cant."),(0,e.Lk)("th",null,"Costo"),(0,e.Lk)("th",null,"Costo Total"),(0,e.Lk)("th",null,"Cantidad Acumulada"),(0,e.Lk)("th",null,"Valor Acumulado"),(0,e.Lk)("th",null,"CPP"),(0,e.Lk)("th",null,"CPP Global"),(0,e.Lk)("th",null,"Descripción")])],-1)),(0,e.Lk)("tbody",null,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(D.kardexFiltrado,((o,t)=>((0,e.uX)(),(0,e.CE)("tr",{key:t},[(0,e.Lk)("td",null,(0,i.v_)(o.fecha),1),(0,e.Lk)("td",null,(0,i.v_)(o.tipo),1),(0,e.Lk)("td",null,(0,i.v_)(o.bodega||"N/A"),1),(0,e.Lk)("td",null,(0,i.v_)("SALIDA"===o.tipo?`-${o.cantidad}`:o.cantidad),1),(0,e.Lk)("td",null,(0,i.v_)(o.costo_unitario?`$${I.formatCosto(o.costo_unitario)}`:"N/A"),1),(0,e.Lk)("td",null,(0,i.v_)("SALIDA"===o.tipo?`-$${I.formatCosto(o.costo_total)}`:`$${I.formatCosto(o.costo_total)}`),1),(0,e.Lk)("td",null,(0,i.v_)(o.saldo),1),(0,e.Lk)("td",null,(0,i.v_)(null!==o.saldo_costo_total&&void 0!==o.saldo_costo_total?`$${I.formatCosto(o.saldo_costo_total)}`:"$0.00"),1),(0,e.Lk)("td",null,(0,i.v_)(null!==o.saldo_costo_unitario&&void 0!==o.saldo_costo_unitario&&o.saldo>0?`$${I.formatCosto(o.saldo_costo_unitario)}`:"N/A"),1),(0,e.Lk)("td",null,(0,i.v_)(o.saldo_costo_unitario_global?`$${I.formatCosto(o.saldo_costo_unitario_global)}`:"N/A"),1),(0,e.Lk)("td",null,(0,i.v_)(o.descripcion),1)])))),128))])])])])):D.mostrarMensajeSinDatos?((0,e.uX)(),(0,e.CE)("section",N,t[33]||(t[33]=[(0,e.Lk)("p",null,"No hay datos para mostrar. Realice una consulta o ajuste el filtro por almacén.",-1)]))):(0,e.Q3)("",!0)])}a(4114),a(8111),a(2489),a(116),a(1701),a(8237),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4603),a(7566),a(8721);var D=a(7682),I=a(3230),E=a(292),V={name:"KardexView",components:{FontAwesomeIcon:E.gc},data(){return{productos:[],bodegas:[],codigoProducto:"",nombreProducto:"",fechaInicio:"",fechaFin:"",kardex:[],kardexFiltrado:[],bodegasSeleccionadas:[],resumenPorAlmacen:[],cppGlobal:null,totalStock:0,totalValor:0,mostrarMensajeSinDatos:!1}},methods:{limpiarPagina(){this.codigoProducto="",this.nombreProducto="",this.fechaInicio="",this.fechaFin="",this.kardex=[],this.kardexFiltrado=[],this.bodegasSeleccionadas=[],this.resumenPorAlmacen=[],this.cppGlobal=null,this.totalStock=0,this.totalValor=0,this.mostrarMensajeSinDatos=!1},async cargarProductos(){try{const o=await D.A.get("/api/productos/completos");this.productos=o.data.sort(((o,t)=>o.codigo.localeCompare(t.codigo)))}catch(o){const t=o.response?.data?.error||o.message;alert(`Error al cargar productos: ${t}`)}},async cargarBodegas(){try{const o=await D.A.get("/inventory/bodegas");this.bodegas=o.data}catch(o){const t=o.response?.data?.error||o.message;alert(`Error al cargar almacenes: ${t}`)}},async consultarKardex(){if(this.codigoProducto&&this.fechaInicio&&this.fechaFin)try{const o={codigo:this.codigoProducto,fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin};this.bodegasSeleccionadas.length>0&&!this.bodegasSeleccionadas.includes("")&&(o.bodegas=this.bodegasSeleccionadas.join(","));const t=await D.A.get("/inventory/kardex",{params:o});console.log("Datos del kardex:",JSON.stringify(t.data,null,2));const a=t.data;if(a.message)return alert(a.message),this.kardex=[],this.kardexFiltrado=[],void(this.mostrarMensajeSinDatos=!0);this.kardex=a.kardex||[],this.kardexFiltrado=[...this.kardex],this.calcularResumen(),this.mostrarMensajeSinDatos=0===this.kardex.length}catch(o){const t=o.response?.data?.error||o.response?.data?.message||o.message;alert(`Error al consultar el kardex: ${t}`),this.kardex=[],this.kardexFiltrado=[],this.mostrarMensajeSinDatos=!0}else alert("Debe seleccionar un producto y definir un rango de fechas.")},calcularResumen(){const o=[...new Set(this.kardex.map((o=>o.bodega)))].filter((o=>o));this.resumenPorAlmacen=o.map((o=>{const t=this.kardex.filter((t=>t.bodega===o)),a=t.reduce(((o,t)=>"ENTRADA"===t.tipo?o+t.cantidad:"SALIDA"===t.tipo?o-t.cantidad:o),0),e=t.reduce(((o,t)=>"ENTRADA"===t.tipo?o+(t.costo_total||0):"SALIDA"===t.tipo?o-(t.costo_total||0):o),0),s=t.filter((o=>"ENTRADA"===o.tipo)),i=s.length>0?s.reduce(((o,t)=>o+(t.costo_unitario||0)),0)/s.length:0;return{almacen:o,stockFinal:parseFloat(a.toFixed(2)),valorAcumulado:e||0,cpp:a>0?i:0}})).sort(((o,t)=>o.almacen.localeCompare(t.almacen))),this.totalStock=parseFloat(this.resumenPorAlmacen.reduce(((o,t)=>o+t.stockFinal),0).toFixed(2)),this.totalValor=this.resumenPorAlmacen.reduce(((o,t)=>o+(t.valorAcumulado||0)),0),this.cppGlobal=this.totalStock>0?this.totalValor/this.totalStock:0},filtrarPorBodega(){this.bodegasSeleccionadas.includes("")||0===this.bodegasSeleccionadas.length?this.kardexFiltrado=[...this.kardex]:this.kardexFiltrado=this.kardex.filter((o=>this.bodegasSeleccionadas.includes(o.bodega))),this.mostrarMensajeSinDatos=0===this.kardexFiltrado.length&&this.kardex.length>0},async imprimirKardexPDF(){if(this.codigoProducto&&this.fechaInicio&&this.fechaFin)try{const o={codigo:this.codigoProducto,fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin};this.bodegasSeleccionadas.length>0&&!this.bodegasSeleccionadas.includes("")&&(o.bodegas=this.bodegasSeleccionadas.join(","));const t=await D.A.get("/api/kardex/pdf",{params:o,responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),e=document.createElement("a");e.href=a,e.setAttribute("download",`kardex_${this.codigoProducto}${this.bodegasSeleccionadas.length?"_"+this.bodegasSeleccionadas.join("_"):""}.pdf`),document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(o){const t=o.response?.data?.error||o.message;alert(`Error al generar el PDF del Kardex: ${t}`)}else alert("Debe realizar una consulta antes de generar el PDF.")},exportarKardexCSV(){if(!this.kardexFiltrado.length)return void alert("No hay datos filtrados para exportar a CSV.");const o=this.productos.find((o=>o.codigo===this.codigoProducto))?.nombre||"Desconocido";let t=`data:text/csv;charset=utf-8,Kardex de Inventario\nProducto: ${this.codigoProducto} - ${o}\nRango de Fechas: ${this.fechaInicio} a ${this.fechaFin}\nAlmacén: ${this.bodegasSeleccionadas.length>0&&!this.bodegasSeleccionadas.includes("")?this.bodegasSeleccionadas.join(", "):"Todos"}\n\nResumen por Almacén\nCPP GLOBAL;${this.cppGlobal?this.formatCosto(this.cppGlobal):"N/A"}\n\nALMACÉN;STOCK FINAL;VALOR ACUMULADO;CPP\n`+this.resumenPorAlmacen.map((o=>`${o.almacen};${this.formatCosto(o.stockFinal)};${o.valorAcumulado?this.formatCosto(o.valorAcumulado):"N/A"};${o.cpp?this.formatCosto(o.cpp):"N/A"}`)).join("\n")+"\n"+`TOTAL;${this.formatCosto(this.totalStock)};${this.totalValor?this.formatCosto(this.totalValor):"N/A"};\n\nMovimientos del Producto\nFecha;Documento;Almacén;Cant.;Costo;Costo Total;Cantidad Acumulada;Valor Acumulado;CPP;CPP Global;Descripción\n`+this.kardexFiltrado.map((o=>[o.fecha,o.tipo,o.bodega||"N/A","SALIDA"===o.tipo?-o.cantidad:o.cantidad,o.costo_unitario?this.formatCosto(o.costo_unitario):"N/A","SALIDA"===o.tipo?`-${this.formatCosto(o.costo_total)}`:o.costo_total?this.formatCosto(o.costo_total):"N/A",this.formatCosto(o.saldo),void 0!==o.saldo_costo_total&&null!==o.saldo_costo_total?this.formatCosto(o.saldo_costo_total):"N/A",o.saldo_costo_unitario?this.formatCosto(o.saldo_costo_unitario):"N/A",o.saldo_costo_unitario_global?this.formatCosto(o.saldo_costo_unitario_global):"N/A",o.descripcion.replace(/;/g," ")].join(";"))).join("\n");const a=encodeURI(t),e=document.createElement("a");e.setAttribute("href",a),e.setAttribute("download",`kardex_${this.codigoProducto}${this.bodegasSeleccionadas.length?"_"+this.bodegasSeleccionadas.join("_"):""}.csv`),document.body.appendChild(e),e.click(),document.body.removeChild(e)},exportarKardexExcel(){if(!this.kardexFiltrado.length)return void alert("No hay datos filtrados para exportar a Excel.");const o=this.productos.find((o=>o.codigo===this.codigoProducto))?.nombre||"Desconocido",t=[["Kardex de Inventario"],[`Producto: ${this.codigoProducto} - ${o}`],[`Rango de Fechas: ${this.fechaInicio} a ${this.fechaFin}`],[`Almacén: ${this.bodegasSeleccionadas.length>0&&!this.bodegasSeleccionadas.includes("")?this.bodegasSeleccionadas.join(", "):"Todos"}`],[],["Resumen por Almacén"],["CPP GLOBAL",this.cppGlobal?this.formatCosto(this.cppGlobal):"N/A"],[],["ALMACÉN","STOCK FINAL","VALOR ACUMULADO","CPP"],...this.resumenPorAlmacen.map((o=>[o.almacen,this.formatCosto(o.stockFinal),o.valorAcumulado?this.formatCosto(o.valorAcumulado):"N/A",o.cpp?this.formatCosto(o.cpp):"N/A"])),["TOTAL",this.formatCosto(this.totalStock),this.totalValor?this.formatCosto(this.totalValor):"N/A",""],[],["Movimientos del Producto"],["Fecha","Documento","Almacén","Cant.","Costo","Costo Total","Cant. Acumulada","Valor Acumulado","CPP","CPP Global","Descripción"],...this.kardexFiltrado.map((o=>[o.fecha,o.tipo,o.bodega||"N/A","SALIDA"===o.tipo?-o.cantidad:o.cantidad,o.costo_unitario?this.formatCosto(o.costo_unitario):"N/A","SALIDA"===o.tipo?`-${this.formatCosto(o.costo_total)}`:o.costo_total?this.formatCosto(o.costo_total):"N/A",this.formatCosto(o.saldo),void 0!==o.saldo_costo_total&&null!==o.saldo_costo_total?this.formatCosto(o.saldo_costo_total):"N/A",o.saldo_costo_unitario?this.formatCosto(o.saldo_costo_unitario):"N/A",o.saldo_costo_unitario_global?this.formatCosto(o.saldo_costo_unitario_global):"N/A",o.descripcion]))],a=I.Wp.aoa_to_sheet(t),e=I.Wp.book_new();I.Wp.book_append_sheet(e,a,"Kardex"),I._h(e,`kardex_${this.codigoProducto}${this.bodegasSeleccionadas.length?"_"+this.bodegasSeleccionadas.join("_"):""}.xlsx`)},sincronizarPorNombre(){if(!this.nombreProducto)return void(this.codigoProducto="");const o=this.productos.find((o=>o.nombre.toLowerCase().includes(this.nombreProducto.toLowerCase())));o&&(this.codigoProducto=o.codigo)},sincronizarCodigoConSelector(){if(!this.codigoProducto)return void(this.nombreProducto="");const o=this.productos.find((o=>o.codigo===this.codigoProducto));o&&(this.nombreProducto=o.nombre)},sincronizarSelectorConCodigo(){const o=this.productos.find((o=>o.codigo===this.codigoProducto));this.nombreProducto=o?o.nombre:""},volverAlMenu(){this.$router.push("/inventory")},formatCosto(o){return Number(o).toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2})}},mounted(){this.cargarProductos(),this.cargarBodegas()}},K=a(1241);const w=(0,K.A)(V,[["render",y],["__scopeId","data-v-070e2c8a"]]);var j=w}}]);
//# sourceMappingURL=274.307c2da8.js.map