"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[994],{531:function(a,t,e){var l=e(6518),o=e(9565),n=e(9306),d=e(8551),u=e(1767),r=e(8646),s=e(9462),i=e(9539),c=e(6395),v=s((function(){var a,t,e=this.iterator,l=this.mapper;while(1){if(t=this.inner)try{if(a=d(o(t.next,t.iterator)),!a.done)return a.value;this.inner=null}catch(n){i(e,"throw",n)}if(a=d(o(this.next,e)),this.done=!!a.done)return;try{this.inner=r(l(a.value,this.counter++),!1)}catch(n){i(e,"throw",n)}}}));l({target:"Iterator",proto:!0,real:!0,forced:c},{flatMap:function(a){return d(this),n(a),new v(u(this),{mapper:a,inner:null})}})},4994:function(a,t,e){e.r(t),e.d(t,{default:function(){return U}});var l=e(6768),o=e(4232),n=e(5130);const d={class:"daily-profit"},u={class:"filters"},r=["value"],s=["value"],i=["value"],c=["value"],v={class:"actions"},p={key:0,class:"no-data-message"},f={key:1,class:"charts-container"},h={class:"chart-wrapper"},y={class:"chart-wrapper"},m={class:"pdv-selector"},C=["value"],k={key:2,class:"table-container"},b={class:"profit-table"},E={key:0,class:"total-row"};function D(a,t,e,D,g,L){const P=(0,l.g2)("Bar"),T=(0,l.g2)("Line");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("h1",null,"Utilidad Diaria por PDV - "+(0,o.v_)(D.months[D.month-1].name)+" "+(0,o.v_)(D.year),1),(0,l.Lk)("div",u,[t[17]||(t[17]=(0,l.Lk)("label",null,"Año:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>D.year=a),onChange:t[1]||(t[1]=(...a)=>D.updateDaysAndFetch&&D.updateDaysAndFetch(...a))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.years,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,r)))),128))],544),[[n.u1,D.year]]),t[18]||(t[18]=(0,l.Lk)("label",null,"Mes:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>D.month=a),onChange:t[3]||(t[3]=(...a)=>D.updateDaysAndFetch&&D.updateDaysAndFetch(...a))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.months,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a.num,value:a.num},(0,o.v_)(a.name),9,s)))),128))],544),[[n.u1,D.month]]),t[19]||(t[19]=(0,l.Lk)("label",null,"Estatus PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>D.status=a),onChange:t[5]||(t[5]=(...a)=>D.fetchData&&D.fetchData(...a))},t[14]||(t[14]=[(0,l.Lk)("option",{value:"Todos"},"Todos",-1),(0,l.Lk)("option",{value:"Activo"},"Activo",-1),(0,l.Lk)("option",{value:"Inactivo"},"Inactivo",-1)]),544),[[n.u1,D.status]]),t[20]||(t[20]=(0,l.Lk)("label",null,"PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>D.selectedPDV=a),onChange:t[7]||(t[7]=(...a)=>D.fetchData&&D.fetchData(...a))},[t[15]||(t[15]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.pdvs,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,i)))),128))],544),[[n.u1,D.selectedPDV]]),t[21]||(t[21]=(0,l.Lk)("label",null,"Día:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>D.selectedDay=a),onChange:t[9]||(t[9]=(...a)=>D.fetchData&&D.fetchData(...a))},[t[16]||(t[16]=(0,l.Lk)("option",{value:"Todos"},"Todos",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.daysInMonth,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,c)))),128))],544),[[n.u1,D.selectedDay]])]),(0,l.Lk)("div",v,[(0,l.Lk)("button",{onClick:t[10]||(t[10]=(...a)=>D.exportToExcel&&D.exportToExcel(...a))},"Exportar a Excel"),(0,l.Lk)("button",{onClick:t[11]||(t[11]=a=>D.downloadChart("barChart"))},"Descargar Gráfico de Utilidad por PDV"),(0,l.Lk)("button",{onClick:t[12]||(t[12]=a=>D.downloadChart("lineChart"))},"Descargar Gráfico de Tendencia")]),D.noData?((0,l.uX)(),(0,l.CE)("div",p," No hay datos disponibles para el mes, año, día y filtros seleccionados. ")):(0,l.Q3)("",!0),D.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",f,[(0,l.Lk)("div",h,[t[22]||(t[22]=(0,l.Lk)("h2",null,"Utilidad Total por PDV",-1)),(0,l.bF)(P,{id:"barChart",data:D.barChartData,options:D.barChartOptions},null,8,["data","options"])]),(0,l.Lk)("div",y,[t[25]||(t[25]=(0,l.Lk)("h2",null,"Tendencia de Utilidad Diaria",-1)),(0,l.Lk)("div",m,[t[24]||(t[24]=(0,l.Lk)("label",null,"Seleccionar PDV:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>D.selectedPdv=a)},[t[23]||(t[23]=(0,l.Lk)("option",{value:"total"},"Total (Todos los PDVs)",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("option",{key:a,value:a},(0,o.v_)(a),9,C)))),128))],512),[[n.u1,D.selectedPdv]])]),(0,l.bF)(T,{id:"lineChart",data:D.lineChartData,options:D.lineChartOptions},null,8,["data","options"])])])),D.noData?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",k,[(0,l.Lk)("table",b,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[t[26]||(t[26]=(0,l.Lk)("th",null,"Fecha",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a,colspan:"4"},(0,o.v_)(a),1)))),128)),t[27]||(t[27]=(0,l.Lk)("th",{colspan:"4"},"Total",-1))]),(0,l.Lk)("tr",null,[t[28]||(t[28]=(0,l.Lk)("th",null,null,-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a+"-ventas"},"Ventas")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a+"-costos"},"Costos")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a+"-produccion"},"Producción")))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("th",{key:a+"-utilidad"},"Utilidad")))),128)),t[29]||(t[29]=(0,l.Lk)("th",null,"Ventas",-1)),t[30]||(t[30]=(0,l.Lk)("th",null,"Costos",-1)),t[31]||(t[31]=(0,l.Lk)("th",null,"Producción",-1)),t[32]||(t[32]=(0,l.Lk)("th",null,"Utilidad",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredDailyProfitData,(a=>((0,l.uX)(),(0,l.CE)("tr",{key:a.date},[(0,l.Lk)("td",null,(0,o.v_)(a.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-ventas"},(0,o.v_)(D.formatCurrency(a[t].ventas)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-costos"},(0,o.v_)(D.formatCurrency(a[t].costos)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-produccion"},(0,o.v_)(D.formatCurrency(a[t].produccion)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t+"-utilidad"},(0,o.v_)(D.formatCurrency(a[t].utilidad)),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(a.total.ventas)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(a.total.costos)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(a.total.produccion)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(a.total.utilidad)),1)])))),128)),D.filteredDailyProfitData.length>0?((0,l.uX)(),(0,l.CE)("tr",E,[(0,l.Lk)("td",null,(0,o.v_)(D.filteredTotals.date),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("td",{key:a+"-ventas"},(0,o.v_)(D.formatCurrency(D.filteredTotals[a].ventas)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("td",{key:a+"-costos"},(0,o.v_)(D.formatCurrency(D.filteredTotals[a].costos)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("td",{key:a+"-produccion"},(0,o.v_)(D.formatCurrency(D.filteredTotals[a].produccion)),1)))),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.filteredPdvs,(a=>((0,l.uX)(),(0,l.CE)("td",{key:a+"-utilidad"},(0,o.v_)(D.formatCurrency(D.filteredTotals[a].utilidad)),1)))),128)),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.ventas)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.costos)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.produccion)),1),(0,l.Lk)("td",null,(0,o.v_)(D.formatCurrency(D.filteredTotals.total.utilidad)),1)])):(0,l.Q3)("",!0)])])]))])}e(4114),e(8111),e(1148),e(2489),e(531),e(7588),e(1701),e(8237),e(7642),e(8004),e(3853),e(5876),e(2475),e(5024),e(1698);var g=e(144),L=e(782),P=e(1387),T=e(7682),_=e(1010),X=e(17),F=e(3408),K=e(3230),$=e(2125),I=e.n($);e(8422);X.t1.register(X.hE,X.m_,X.s$,X.E8,X.No,X.FN,X.PP,X.kc,X.UA,F.A);var V={name:"DailyProfit",components:{Bar:_.yP,Line:_.N1},setup(){const a=(0,L.Pj)(),t=(0,P.rd)(),e=(0,g.KR)(null),o=(0,g.KR)([]),n=new Date,d=n.getMonth()+1,u=n.getFullYear(),r=(0,g.KR)(d),s=(0,g.KR)("Activo"),i=(0,g.KR)("Todos"),c=(0,g.KR)("Todos"),v=(0,g.KR)([]),p=(0,g.KR)([]),f=(0,g.KR)([]),h=(0,g.KR)([]),y=(0,g.KR)([]),m=(0,g.KR)({}),C=(0,g.KR)({}),k=(0,g.KR)("total"),b=(0,g.KR)([{num:1,name:"Enero"},{num:2,name:"Febrero"},{num:3,name:"Marzo"},{num:4,name:"Abril"},{num:5,name:"Mayo"},{num:6,name:"Junio"},{num:7,name:"Julio"},{num:8,name:"Agosto"},{num:9,name:"Septiembre"},{num:10,name:"Octubre"},{num:11,name:"Noviembre"},{num:12,name:"Diciembre"}]),E=(0,l.EW)((()=>0===f.value.length||f.value.every((a=>0===a.total.utilidad)))),D=()=>{if(!e.value||!r.value)return;const a={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};2!==r.value||e.value%4!==0||e.value%100===0&&e.value%400!==0||(a[2]=29);const t=a[r.value]||30;v.value=Array.from({length:t},((a,t)=>t+1)),c.value="Todos"},_=async()=>{try{const a=await T.A.get("/available-years");o.value=a.data.years||[],o.value.length>0&&(e.value=o.value.includes(u)?u:o.value[0],D(),X(),F())}catch(a){console.error("Error fetching available years:",a),o.value=Array.from({length:5},((a,t)=>u+t-2)),e.value=u,D(),a.response&&401===a.response.status?t.push("/login"):(X(),F())}},X=async()=>{try{const a={year:e.value,month:r.value,status:s.value};"Todos"!==c.value&&(a.day=c.value);const t=await T.A.get("/dashboard/product-profit",{params:a}),l=t.data.data||[],o=new Set;l.forEach((a=>{Object.keys(a.almacenes||{}).forEach((a=>o.add(a)))})),h.value=Array.from(o).sort()}catch(a){console.error("Error fetching PDVs:",a),h.value=[]}},F=async()=>{if(e.value)try{const a={year:e.value,month:r.value,status:s.value};"Todos"!==i.value&&(a.pdv=i.value),"Todos"!==c.value&&(a.day=c.value);const t=await T.A.get("/dashboard/product-profit",{params:a}),l=t.data.data||[],o={},n={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};2!==r.value||e.value%4!==0||e.value%100===0&&e.value%400!==0||(n[2]=29);const d=n[r.value]||30;for(let u=1;u<=d;u++){const a=new Date(e.value,r.value-1,u),t=a.toLocaleDateString("es-ES",{weekday:"long"}),l=`${t}, ${u.toString().padStart(2,"0")}/${r.value.toString().padStart(2,"0")}/${e.value}`;o[u]={date:l,pdvs:{},total:{ventas:0,costos:0,produccion:0,utilidad:0}},h.value.forEach((a=>{o[u].pdvs[a]={ventas:0,costos:0,produccion:0,utilidad:0}}))}l.forEach((a=>{const t=a.almacenes||{};Object.entries(t).forEach((([t,e])=>{const l="Todos"!==c.value?parseInt(c.value):1;o[l]&&(o[l].pdvs[t]=o[l].pdvs[t]||{ventas:0,costos:0,produccion:0,utilidad:0},o[l].pdvs[t].ventas+=e.venta||0,o[l].pdvs[t].costos+=a.costos*(e.cantidad_vendida/a.cantidad_vendida)||0,o[l].pdvs[t].produccion+=a.produccion*(e.cantidad_vendida/a.cantidad_vendida)||0,o[l].pdvs[t].utilidad+=a.utilidad*(e.cantidad_vendida/a.cantidad_vendida)||0)}))})),Object.values(o).forEach((a=>{Object.entries(a.pdvs).forEach((([t,e])=>{a.total.ventas+=e.ventas,a.total.costos+=e.costos,a.total.produccion+=e.produccion,a.total.utilidad+=e.utilidad}))})),p.value=Object.values(o).filter((a=>a.total.utilidad>0||"Todos"!==c.value)),$()}catch(a){console.error("Error fetching daily profit data:",a),p.value=[],f.value=[],y.value=[],C.value={},a.response&&401===a.response.status&&t.push("/login")}},$=()=>{if("Todos"===i.value?y.value=h.value:y.value=h.value.filter((a=>a===i.value)),"Todos"===c.value)f.value=p.value;else{const a=c.value.toString().padStart(2,"0"),t=r.value.toString().padStart(2,"0"),l=`${a}/${t}/${e.value}`;f.value=p.value.filter((a=>a.date.includes(l)))}C.value={date:"TOTALES"},y.value.forEach((a=>{C.value[a]={ventas:f.value.reduce(((t,e)=>t+(e.pdvs[a]?.ventas||0)),0),costos:f.value.reduce(((t,e)=>t+(e.pdvs[a]?.costos||0)),0),produccion:f.value.reduce(((t,e)=>t+(e.pdvs[a]?.produccion||0)),0),utilidad:f.value.reduce(((t,e)=>t+(e.pdvs[a]?.utilidad||0)),0)}})),C.value.total={ventas:f.value.reduce(((a,t)=>a+(t.total?.ventas||0)),0),costos:f.value.reduce(((a,t)=>a+(t.total?.costos||0)),0),produccion:f.value.reduce(((a,t)=>a+(t.total?.produccion||0)),0),utilidad:f.value.reduce(((a,t)=>a+(t.total?.utilidad||0)),0)}},V=()=>{D(),X(),F()},w=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a),A=(0,l.EW)((()=>({labels:y.value,datasets:[{label:"Utilidad Total (COP)",data:y.value.map((a=>C.value[a]?.utilidad||0)),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}))),U={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(a){return w(a)}}},x:{title:{display:!0,text:"Punto de Venta"}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${w(a.parsed.y)}`}}},datalabels:{display:!0,anchor:"center",align:"center",color:"#fff",font:{size:13,weight:"bold"},formatter:function(a){return w(a)}}}},x=(0,l.EW)((()=>{const a=f.value.map((a=>{const t=a.date.split(", ")[1],[e,l,o]=t.split("/");return`${o}-${l}-${e}`}));let t;return t="total"===k.value?f.value.map((a=>a.total.utilidad)):f.value.map((a=>a.pdvs[k.value]?.utilidad||0)),{labels:a,datasets:[{label:"total"===k.value?"Utilidad Total (COP)":`Utilidad de ${k.value} (COP)`,data:t,fill:!1,borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.1}]}})),O={responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"dd/MM/yyyy",displayFormats:{day:"dd/MM/yyyy"}},title:{display:!0,text:"Fecha"}},y:{beginAtZero:!0,title:{display:!0,text:"Utilidad (COP)"},ticks:{callback:function(a){return w(a)}}}},plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(a){return`${a.dataset.label}: ${w(a.parsed.y)}`}}},datalabels:{display:!1}}},R=()=>{const a=f.value.map((a=>{const t={Fecha:a.date};return y.value.forEach((e=>{t[`${e} - Ventas`]=a.pdvs[e].ventas,t[`${e} - Costos`]=a.pdvs[e].costos,t[`${e} - Producción`]=a.pdvs[e].produccion,t[`${e} - Utilidad`]=a.pdvs[e].utilidad})),t["Total - Ventas"]=a.total.ventas,t["Total - Costos"]=a.total.costos,t["Total - Producción"]=a.total.produccion,t["Total - Utilidad"]=a.total.utilidad,t}));a.push({Fecha:C.value.date,...Object.fromEntries(y.value.flatMap((a=>[[`${a} - Ventas`,C.value[a].ventas],[`${a} - Costos`,C.value[a].costos],[`${a} - Producción`,C.value[a].produccion],[`${a} - Utilidad`,C.value[a].utilidad]]))),"Total - Ventas":C.value.total.ventas,"Total - Costos":C.value.total.costos,"Total - Producción":C.value.total.produccion,"Total - Utilidad":C.value.total.utilidad});const t=K.Wp.json_to_sheet(a),l=K.Wp.book_new();K.Wp.book_append_sheet(l,t,"Utilidad Diaria"),K._h(l,`Utilidad_Diaria_${e.value}_${r.value}${"Todos"!==c.value?`_Dia${c.value}`:""}.xlsx`)},S=async a=>{const t=document.getElementById(a),l=document.createElement("a");l.href=await I()(t).then((a=>a.toDataURL("image/png"))),l.download=`${a}_${e.value}_${r.value}${"Todos"!==c.value?`_Dia${c.value}`:""}.png`,l.click()};return(0,l.sV)((()=>{a.state.auth.token?_():t.push("/login")})),(0,l.wB)(k,(()=>{console.log("PDV seleccionado cambiado a:",k.value)})),{year:e,years:o,month:r,months:b,status:s,selectedPDV:i,selectedDay:c,daysInMonth:v,dailyProfitData:p,filteredDailyProfitData:f,pdvs:h,filteredPdvs:y,totals:m,filteredTotals:C,noData:E,selectedPdv:k,barChartData:A,barChartOptions:U,lineChartData:x,lineChartOptions:O,fetchData:F,updateDaysAndFetch:V,formatCurrency:w,exportToExcel:R,downloadChart:S}}},w=e(1241);const A=(0,w.A)(V,[["render",D],["__scopeId","data-v-13dca109"]]);var U=A},8646:function(a,t,e){var l=e(9565),o=e(8551),n=e(1767),d=e(851);a.exports=function(a,t){t&&"string"===typeof a||o(a);var e=d(a);return n(o(void 0!==e?l(e,a):a))}}}]);
//# sourceMappingURL=994.d6cad49d.js.map