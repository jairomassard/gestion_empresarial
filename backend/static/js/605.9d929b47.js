"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[605],{6605:function(o,t,i){i.r(t),i.d(t,{default:function(){return A}});var a=i(6768),r=i(5130),s=i(4232);const e={class:"consulta-inventario"},n={class:"form-section"},d={class:"form-actions",style:{"justify-content":"flex-end"}},c={class:"form-group"},l={class:"form-group"},u={class:"form-group"},g=["value"],p={class:"form-actions"},h={key:0,class:"form-section"},b={class:"form-group"},m=["value"],v={key:1},f={class:"form-actions"},k={class:"table-container"},L={key:0,class:"paginacion"},_=["disabled"],C=["disabled"];function P(o,t,i,P,D,I){const E=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",e,[t[24]||(t[24]=(0,a.Lk)("h1",null,"Consulta de Inventario de Productos",-1)),(0,a.Lk)("section",n,[(0,a.Lk)("div",d,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...o)=>I.limpiarPagina&&I.limpiarPagina(...o)),class:"btn btn-warning"},"Limpiar Página")]),(0,a.Lk)("div",c,[t[13]||(t[13]=(0,a.Lk)("label",{for:"nombreFiltro"},"Buscar por nombre:",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text",id:"nombreFiltro","onUpdate:modelValue":t[1]||(t[1]=o=>D.nombreDigitado=o),placeholder:"Ingrese nombre del producto",onInput:t[2]||(t[2]=(...o)=>I.sincronizarPorNombre&&I.sincronizarPorNombre(...o))},null,544),[[r.Jo,D.nombreDigitado]])]),(0,a.Lk)("div",l,[t[14]||(t[14]=(0,a.Lk)("label",{for:"codigoFiltro"},"Buscar por código:",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>D.codigoDigitado=o),id:"codigoFiltro",placeholder:"Ingrese código de producto",onInput:t[4]||(t[4]=(...o)=>I.sincronizarCodigoConSelector&&I.sincronizarCodigoConSelector(...o))},null,544),[[r.Jo,D.codigoDigitado]])]),(0,a.Lk)("div",u,[t[16]||(t[16]=(0,a.Lk)("label",{for:"productoSelector"},"Seleccione un producto:",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>D.filtroProducto=o),id:"productoSelector",onChange:t[6]||(t[6]=(...o)=>I.sincronizarSelectorConCodigo&&I.sincronizarSelectorConCodigo(...o))},[t[15]||(t[15]=(0,a.Lk)("option",{value:""},"Todos",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.productosDisponibles,(o=>((0,a.uX)(),(0,a.CE)("option",{key:o.codigo,value:o.codigo},(0,s.v_)(o.codigo)+" - "+(0,s.v_)(o.nombre),9,g)))),128))],544),[[r.u1,D.filtroProducto]])]),(0,a.Lk)("div",p,[(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...o)=>I.consultar&&I.consultar(...o)),class:"btn"},"Consultar Inventario")])]),D.mostrarInventario&&""===D.filtroProducto&&""===D.codigoDigitado?((0,a.uX)(),(0,a.CE)("section",h,[(0,a.Lk)("div",b,[t[18]||(t[18]=(0,a.Lk)("label",{for:"filtroBodega"},"Filtrar por bodega:",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>D.filtroBodega=o),id:"filtroBodega",onChange:t[9]||(t[9]=(...o)=>I.filtrarPorBodega&&I.filtrarPorBodega(...o))},[t[17]||(t[17]=(0,a.Lk)("option",{value:""},"Todas",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.bodegas,(o=>((0,a.uX)(),(0,a.CE)("option",{key:o,value:o},(0,s.v_)(o),9,m)))),128))],544),[[r.u1,D.filtroBodega]])])])):(0,a.Q3)("",!0),D.mostrarInventario?((0,a.uX)(),(0,a.CE)("section",v,[t[23]||(t[23]=(0,a.Lk)("h2",null,"Inventario de Productos",-1)),(0,a.Lk)("div",f,[D.productosFiltrados.length?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[10]||(t[10]=(...o)=>I.exportarAExcel&&I.exportarAExcel(...o)),class:"btn"},[t[19]||(t[19]=(0,a.eW)(" Exportar a Excel ")),(0,a.bF)(E,{icon:"file-excel",class:"excel-icon"})])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",k,[(0,a.Lk)("table",null,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[t[20]||(t[20]=(0,a.Lk)("th",null,"Código",-1)),t[21]||(t[21]=(0,a.Lk)("th",null,"Nombre",-1)),t[22]||(t[22]=(0,a.Lk)("th",null,"Total",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.bodegasMostradas,(o=>((0,a.uX)(),(0,a.CE)("th",{key:o},(0,s.v_)(o),1)))),128))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.productosFiltrados,(o=>((0,a.uX)(),(0,a.CE)("tr",{key:o.codigo},[(0,a.Lk)("td",null,(0,s.v_)(o.codigo),1),(0,a.Lk)("td",null,(0,s.v_)(o.nombre),1),(0,a.Lk)("td",null,(0,s.v_)(o.cantidad_total),1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.bodegasMostradas,(t=>((0,a.uX)(),(0,a.CE)("td",{key:t},(0,s.v_)(o.cantidades_por_bodega[t]||0),1)))),128))])))),128))])])]),""===D.filtroProducto&&""===D.codigoDigitado?((0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("button",{disabled:1===D.paginaActual,onClick:t[11]||(t[11]=o=>I.cambiarPagina(D.paginaActual-1)),class:"btn"},"Anterior",8,_),(0,a.Lk)("span",null,"Página "+(0,s.v_)(D.paginaActual),1),(0,a.Lk)("button",{disabled:D.productos.length<D.limite,onClick:t[12]||(t[12]=o=>I.cambiarPagina(D.paginaActual+1)),class:"btn"},"Siguiente",8,C)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])}i(4114),i(8111),i(116),i(1701),i(8237);var D=i(7682),I=i(3230),E={name:"ConsultaInventarioLite",data(){return{filtroProducto:"",codigoDigitado:"",nombreDigitado:"",productosDisponibles:[],productos:[],productosFiltrados:[],bodegas:[],bodegasMostradas:[],filtroBodega:"",mostrarInventario:!1,paginaActual:1,limite:20,todosLosProductos:[]}},methods:{limpiarPagina(){this.codigoDigitado="",this.nombreDigitado="",this.filtroProducto="",this.filtroBodega="",this.productos=[],this.productosFiltrados=[],this.bodegas=[],this.bodegasMostradas=[],this.mostrarInventario=!1,this.paginaActual=1,this.todosLosProductos=[]},async consultar(){this.filtroProducto||this.codigoDigitado||this.nombreDigitado?await this.consultarProductoEspecifico():await this.consultarTodosLosProductos()},async consultarProductoEspecifico(){try{const o=this.filtroProducto||this.codigoDigitado;let t=`/api/inventario/${o}`;this.nombreDigitado&&!o&&(t=`/api/inventario?nombre=${encodeURIComponent(this.nombreDigitado)}&limit=999999`);const i=await D.A.get(t),a=i.data;if(a.error)return alert(a.error),void this.limpiarPagina();if(a.message)return alert(a.message),this.mostrarInventario=!1,this.productos=[],void(this.bodegas=[]);const r=await D.A.get("/inventory/bodegas"),s=r.data.map((o=>o.nombre));this.bodegas=s,this.bodegasMostradas=s,a.producto?this.productos=[{codigo:a.producto.codigo,nombre:a.producto.nombre,cantidad_total:a.inventario.reduce(((o,t)=>o+t.cantidad),0),cantidades_por_bodega:s.reduce(((o,t)=>{const i=a.inventario.find((o=>o.bodega===t));return o[t]=i?i.cantidad:0,o}),{})}]:this.productos=a.productos.map((o=>({codigo:o.codigo,nombre:o.nombre,cantidad_total:o.cantidad_total,cantidades_por_bodega:o.cantidades_por_bodega}))),this.productosFiltrados=[...this.productos],this.mostrarInventario=!0}catch(o){console.error("Error al consultar inventario específico:",o),403===o.response?.status?(alert("No tienes permiso para consultar el inventario."),this.$router.push("/login")):404===o.response?.status?alert("Producto no encontrado."):alert("Ocurrió un error al consultar el inventario."),this.mostrarInventario=!1}},async consultarTodosLosProductos(){try{const o=(this.paginaActual-1)*this.limite,t=await D.A.get(`/api/inventario?offset=${o}&limit=${this.limite}`),{productos:i,bodegas:a,total:r}=t.data;if(!i||0===i.length)return alert("No se encontró información en el inventario."),void(this.mostrarInventario=!1);if(this.bodegas=a||[],this.bodegasMostradas=[...this.bodegas],this.productos=i.map((o=>({codigo:o.codigo,nombre:o.nombre,cantidad_total:o.cantidad_total,cantidades_por_bodega:{...o.cantidades_por_bodega}}))),this.productosFiltrados=[...this.productos],this.mostrarInventario=!0,r>this.limite){const o=await D.A.get("/api/inventario?limit=999999");this.todosLosProductos=o.data.productos.map((o=>({codigo:o.codigo,nombre:o.nombre,cantidad_total:o.cantidad_total,cantidades_por_bodega:{...o.cantidades_por_bodega}})))}else this.todosLosProductos=[...this.productos]}catch(o){console.error("Error al consultar inventario general:",o),403===o.response?.status?(alert("No tienes permiso para consultar el inventario."),this.$router.push("/login")):alert("Ocurrió un error al consultar el inventario general."),this.mostrarInventario=!1}},filtrarPorBodega(){this.filtroBodega?(this.bodegasMostradas=[this.filtroBodega],this.productosFiltrados=this.productos.map((o=>({...o,cantidad_total:o.cantidades_por_bodega[this.filtroBodega]||0})))):(this.bodegasMostradas=[...this.bodegas],this.productosFiltrados=[...this.productos])},async cargarProductosDisponibles(){try{const o=await D.A.get("/api/productos/completos");this.productosDisponibles=o.data.sort(((o,t)=>o.codigo.localeCompare(t.codigo)))}catch(o){console.error("Error al cargar productos disponibles:",o),403===o.response?.status&&(alert("No tienes permiso para acceder a los productos."),this.$router.push("/login"))}},cambiarPagina(o){this.paginaActual=o,this.consultarTodosLosProductos()},sincronizarPorNombre(){const o=this.productosDisponibles.find((o=>o.nombre.toLowerCase().includes(this.nombreDigitado.toLowerCase())));o&&(this.filtroProducto=o.codigo,this.codigoDigitado=o.codigo)},sincronizarCodigoConSelector(){const o=this.productosDisponibles.find((o=>o.codigo===this.codigoDigitado));o&&(this.filtroProducto=o.codigo,this.nombreDigitado=o.nombre)},sincronizarSelectorConCodigo(){const o=this.productosDisponibles.find((o=>o.codigo===this.filtroProducto));o?(this.codigoDigitado=o.codigo,this.nombreDigitado=o.nombre):(this.codigoDigitado="",this.nombreDigitado="")},volverAlMenu(){this.$router.push("/menu-operador")},exportarAExcel(){const o=this.filtroProducto||this.codigoDigitado||this.nombreDigitado?this.productosFiltrados:this.todosLosProductos,t=[["Consulta de Inventario de Productos"],["Código","Nombre","Total",...this.bodegasMostradas],...o.map((o=>[o.codigo,o.nombre,o.cantidad_total,...this.bodegasMostradas.map((t=>o.cantidades_por_bodega[t]||0))]))],i=I.Wp.aoa_to_sheet(t),a=I.Wp.book_new();I.Wp.book_append_sheet(a,i,"Inventario"),I._h(a,`inventario_${(new Date).toISOString().slice(0,10)}.xlsx`)}},mounted(){this.cargarProductosDisponibles()}},y=i(1241);const F=(0,y.A)(E,[["render",P],["__scopeId","data-v-10484070"]]);var A=F}}]);
//# sourceMappingURL=605.9d929b47.js.map