"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[897],{4897:function(e,a,o){o.r(a),o.d(a,{default:function(){return ne}});var t=o(6768),r=o(5130),n=o(4232);const d={class:"produccion-admin"},i={class:"actions",style:{"justify-content":"flex-end"}},l=["value"],s=["value"],c={key:0},u={key:0},p=["onClick"],m=["onClick"],h=["onClick"],k=["onClick"],g=["onClick"],b=["onClick"],L=["onClick"],_={key:1},C={key:1,class:"detalle-orden"},P={class:"acciones-orden"},v={class:"info-general-card"},O={class:"info-row1"},f={class:"info-item numero-orden"},E={class:"value"},y={class:"info-item producto"},N={class:"value"},F={class:"info-row2"},z={class:"info-item cantidad-paquetes"},w={class:"value"},X={class:"info-item bodega-produccion"},A={class:"value"},q={class:"info-item estado"},D={class:"tabla-costos"},I={class:"value"},x={class:"value"},$={class:"tabla-fechas"},V={class:"tabla-responsables"},S={class:"value"},T={class:"value"},Q={class:"tabla-componentes"},U={key:2},R={key:0},H=["disabled"],B={key:1},J={key:1},K=["max"],M={key:2},W={key:3},j={key:0},G={key:1},Y={key:2},Z={key:3};function ee(e,a,o,ee,ae,oe){return(0,t.uX)(),(0,t.CE)("div",d,[a[71]||(a[71]=(0,t.Lk)("h1",null,"Módulo de Producción",-1)),(0,t.Lk)("div",i,[(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>oe.limpiarPagina&&oe.limpiarPagina(...e)),class:"btn btn-warning"},"Limpiar Página")]),(0,t.Lk)("section",null,[a[38]||(a[38]=(0,t.Lk)("h2",null,"Crear Orden de Producción",-1)),(0,t.Lk)("form",{onSubmit:a[9]||(a[9]=(0,r.D$)(((...e)=>oe.revisarOrden&&oe.revisarOrden(...e)),["prevent"]))},[a[30]||(a[30]=(0,t.Lk)("label",{for:"nombreProducto"},"Buscar por nombre:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"nombreProducto","onUpdate:modelValue":a[1]||(a[1]=e=>ae.nombreProductoCompuesto=e),placeholder:"Ingrese nombre del producto",class:"form-control",onInput:a[2]||(a[2]=(...e)=>oe.sincronizarPorNombre&&oe.sincronizarPorNombre(...e))},null,544),[[r.Jo,ae.nombreProductoCompuesto]]),a[31]||(a[31]=(0,t.Lk)("label",{for:"codigoProducto"},"Código del Producto:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"codigoProducto","onUpdate:modelValue":a[3]||(a[3]=e=>ae.codigoProductoCompuesto=e),placeholder:"Ingrese el código del producto compuesto",onInput:a[4]||(a[4]=(...e)=>oe.sincronizarCodigoConSelector&&oe.sincronizarCodigoConSelector(...e))},null,544),[[r.Jo,ae.codigoProductoCompuesto]]),a[32]||(a[32]=(0,t.Lk)("label",{for:"producto"},"Producto Compuesto:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>ae.nuevaOrden.producto_compuesto_id=e),onChange:a[6]||(a[6]=(...e)=>oe.sincronizarSelectorConCodigo&&oe.sincronizarSelectorConCodigo(...e)),required:""},[a[28]||(a[28]=(0,t.Lk)("option",{value:"",disabled:""},"Seleccione un producto",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.productosCompuestos,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.codigo)+" - "+(0,n.v_)(e.nombre),9,l)))),128))],544),[[r.u1,ae.nuevaOrden.producto_compuesto_id]]),a[33]||(a[33]=(0,t.Lk)("br",null,null,-1)),a[34]||(a[34]=(0,t.Lk)("label",{for:"cantidad"},"Cantidad de Paquetes a Producir:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=e=>ae.nuevaOrden.cantidad_paquetes=e),required:"",min:"1"},null,512),[[r.Jo,ae.nuevaOrden.cantidad_paquetes]]),a[35]||(a[35]=(0,t.Lk)("label",{for:"bodegaProduccion"},"Bodega de Producción:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>ae.nuevaOrden.bodega_produccion=e),required:""},[a[29]||(a[29]=(0,t.Lk)("option",{value:"",disabled:""},"Seleccione una bodega",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.bodegas,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.id},(0,n.v_)(e.nombre),9,s)))),128))],512),[[r.u1,ae.nuevaOrden.bodega_produccion]]),a[36]||(a[36]=(0,t.Lk)("br",null,null,-1)),a[37]||(a[37]=(0,t.Lk)("button",{type:"submit"},"Revisar",-1))],32)]),ae.tablaRevisarVisible?((0,t.uX)(),(0,t.CE)("section",c,[a[40]||(a[40]=(0,t.Lk)("h3",null,"Revisión de Componentes",-1)),(0,t.Lk)("table",null,[a[39]||(a[39]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Componentes"),(0,t.Lk)("th",null,"Cant. x Paquete"),(0,t.Lk)("th",null,"Cant. a Producir"),(0,t.Lk)("th",null,"Cant. Total Req."),(0,t.Lk)("th",null,"Peso Unitario"),(0,t.Lk)("th",null,"Peso Total"),(0,t.Lk)("th",null,"Costo Unitario"),(0,t.Lk)("th",null,"Costo Total")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.componentes,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id},[(0,t.Lk)("td",null,(0,n.v_)(e.nombre),1),(0,t.Lk)("td",null,(0,n.v_)(e.cantidad_requerida),1),(0,t.Lk)("td",null,(0,n.v_)(ae.nuevaOrden.cantidad_paquetes),1),(0,t.Lk)("td",null,(0,n.v_)(e.cantidad_total.toFixed(2)),1),(0,t.Lk)("td",null,(0,n.v_)(e.peso_unitario),1),(0,t.Lk)("td",null,(0,n.v_)(e.peso_total.toFixed(2)),1),(0,t.Lk)("td",null,"$"+(0,n.v_)(e.costo_unitario.toFixed(2)),1),(0,t.Lk)("td",null,"$"+(0,n.v_)(e.costo_total.toFixed(2)),1)])))),128))])]),(0,t.Lk)("button",{onClick:a[10]||(a[10]=(...e)=>oe.crearOrden&&oe.crearOrden(...e))},"Crear Orden")])):(0,t.Q3)("",!0),(0,t.Lk)("section",null,[a[48]||(a[48]=(0,t.Lk)("h2",null,"Órdenes de Producción",-1)),(0,t.Lk)("div",null,[a[42]||(a[42]=(0,t.Lk)("label",{for:"numero-orden"},"Número de Orden:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"numero-orden","onUpdate:modelValue":a[11]||(a[11]=e=>ae.filtroNumeroOrden=e),placeholder:"Ingrese el número de orden"},null,512),[[r.Jo,ae.filtroNumeroOrden]]),a[43]||(a[43]=(0,t.Lk)("label",{for:"estado"},"Estado:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[12]||(a[12]=e=>ae.filtroEstado=e),id:"estado"},a[41]||(a[41]=[(0,t.Fv)('<option value="" data-v-4c67c99c>Todos</option><option value="Pendiente" data-v-4c67c99c>Pendiente</option><option value="Lista para Producción" data-v-4c67c99c>Lista para Producción</option><option value="En Producción" data-v-4c67c99c>En Producción</option><option value="En Producción-Parcial" data-v-4c67c99c>En Producción-Parcial</option><option value="Finalizada" data-v-4c67c99c>Finalizada</option>',6)]),512),[[r.u1,ae.filtroEstado]]),a[44]||(a[44]=(0,t.Lk)("br",null,null,-1)),(0,t.Lk)("button",{onClick:a[13]||(a[13]=(...e)=>oe.consultarOrdenes&&oe.consultarOrdenes(...e))},"Consultar")]),ae.ordenes.length>0?((0,t.uX)(),(0,t.CE)("table",u,[a[47]||(a[47]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"ID"),(0,t.Lk)("th",null,"Número de Orden"),(0,t.Lk)("th",null,"Producto"),(0,t.Lk)("th",null,"Cantidad a Producir"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.ordenes,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id},[(0,t.Lk)("td",null,(0,n.v_)(e.id),1),(0,t.Lk)("td",null,(0,n.v_)(e.numero_orden),1),(0,t.Lk)("td",null,(0,n.v_)(e.producto_compuesto_nombre),1),(0,t.Lk)("td",null,(0,n.v_)(e.cantidad_paquetes),1),(0,t.Lk)("td",null,(0,n.v_)(e.estado),1),(0,t.Lk)("td",null,["Pendiente"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:a=>oe.actualizarEstado(e.id,"Lista para Producción")}," Marcar Lista para Producción ",8,p)):(0,t.Q3)("",!0),"Lista para Producción"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:a=>oe.actualizarEstado(e.id,"En Producción")}," Iniciar Producción ",8,m)):(0,t.Q3)("",!0),"En Producción"===e.estado||"En Producción-Parcial"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:2,onClick:a=>oe.registrarProduccion(e.id)}," Registrar Producción ",8,h)):(0,t.Q3)("",!0),"Pendiente"===e.estado||"Lista para Producción"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:3,onClick:a=>oe.eliminarOrden(e.id),class:"btn btn-danger"}," Eliminar Orden ",8,k)):(0,t.Q3)("",!0),(0,t.Lk)("button",{onClick:a=>oe.cargarDetalleOrden(e.id)},"Detalle",8,g),(0,t.Lk)("button",{onClick:a=>oe.descargarPdf(e.id)},a[45]||(a[45]=[(0,t.eW)("Imprimir "),(0,t.Lk)("i",{class:"fas fa-file-pdf pdf-icon"},null,-1)]),8,b),(0,t.Lk)("button",{onClick:a=>oe.descargarPdfOperador(e.id)},a[46]||(a[46]=[(0,t.eW)("Imprimir Sin costos "),(0,t.Lk)("i",{class:"fas fa-file-pdf pdf-icon"},null,-1)]),8,L)])])))),128))])])):(0,t.Q3)("",!0),0===ae.ordenes.length?((0,t.uX)(),(0,t.CE)("p",_,"No se encontraron órdenes de producción.")):(0,t.Q3)("",!0)]),ae.tablaDetalleVisible?((0,t.uX)(),(0,t.CE)("section",C,[a[63]||(a[63]=(0,t.Lk)("h2",null,"Detalle de la Orden",-1)),(0,t.Lk)("div",P,["Pendiente"===ae.detalleOrden?.estado?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:a[14]||(a[14]=e=>oe.actualizarEstado(ae.detalleOrden.id,"Lista para Producción"))}," Marcar Lista para Producción ")):(0,t.Q3)("",!0),"Lista para Producción"===ae.detalleOrden?.estado?((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:a[15]||(a[15]=e=>oe.actualizarEstado(ae.detalleOrden.id,"En Producción"))}," Iniciar Producción ")):(0,t.Q3)("",!0),"En Producción"===ae.detalleOrden?.estado||"En Producción-Parcial"===ae.detalleOrden?.estado?((0,t.uX)(),(0,t.CE)("button",{key:2,onClick:a[16]||(a[16]=e=>oe.registrarProduccion(ae.detalleOrden.id))}," Registrar Producción ")):(0,t.Q3)("",!0),"Pendiente"===ae.detalleOrden?.estado||"Lista para Producción"===ae.detalleOrden?.estado?((0,t.uX)(),(0,t.CE)("button",{key:3,onClick:a[17]||(a[17]=e=>oe.eliminarOrden(ae.detalleOrden.id)),class:"btn btn-danger"}," Eliminar Orden ")):(0,t.Q3)("",!0),(0,t.Lk)("button",{onClick:a[18]||(a[18]=e=>oe.descargarPdf(ae.detalleOrden?.id))},a[49]||(a[49]=[(0,t.eW)("Imprimir "),(0,t.Lk)("i",{class:"fas fa-file-pdf pdf-icon"},null,-1)])),(0,t.Lk)("button",{onClick:a[19]||(a[19]=e=>oe.descargarPdfOperador(ae.detalleOrden?.id))},a[50]||(a[50]=[(0,t.eW)("Imprimir Sin costos "),(0,t.Lk)("i",{class:"fas fa-file-pdf pdf-icon"},null,-1)]))]),(0,t.Lk)("div",v,[a[56]||(a[56]=(0,t.Lk)("h3",null,"Información General",-1)),(0,t.Lk)("div",O,[(0,t.Lk)("div",f,[a[51]||(a[51]=(0,t.Lk)("span",{class:"label"},"Número de Orden",-1)),(0,t.Lk)("span",E,(0,n.v_)(ae.detalleOrden?.numero_orden||"N/A"),1)]),(0,t.Lk)("div",y,[a[52]||(a[52]=(0,t.Lk)("span",{class:"label"},"Producto",-1)),(0,t.Lk)("span",N,(0,n.v_)(ae.detalleOrden?.producto_compuesto_nombre||"N/A"),1)])]),(0,t.Lk)("div",F,[(0,t.Lk)("div",z,[a[53]||(a[53]=(0,t.Lk)("span",{class:"label"},"Cantidad de Paquetes",-1)),(0,t.Lk)("span",w,(0,n.v_)(ae.detalleOrden?.cantidad_paquetes||"N/A"),1)]),(0,t.Lk)("div",X,[a[54]||(a[54]=(0,t.Lk)("span",{class:"label"},"Bodega de Producción",-1)),(0,t.Lk)("span",A,(0,n.v_)(ae.detalleOrden?.bodega_produccion_nombre||"No especificada"),1)]),(0,t.Lk)("div",q,[a[55]||(a[55]=(0,t.Lk)("span",{class:"label"},"Estado",-1)),(0,t.Lk)("span",{class:(0,n.C4)(["value",oe.estadoClass(ae.detalleOrden?.estado)])},(0,n.v_)(ae.detalleOrden?.estado||"N/A"),3)])])]),(0,t.Lk)("table",D,[(0,t.Lk)("tbody",null,[(0,t.Lk)("tr",null,[a[57]||(a[57]=(0,t.Lk)("td",{class:"label"},"Costo Unitario",-1)),(0,t.Lk)("td",I,"$"+(0,n.v_)(ae.detalleOrden?.costo_unitario?.toFixed(2)||"N/A"),1),a[58]||(a[58]=(0,t.Lk)("td",{class:"label"},"Costo Total",-1)),(0,t.Lk)("td",x,"$"+(0,n.v_)(ae.detalleOrden?.costo_total?.toFixed(2)||"N/A"),1)])])]),(0,t.Lk)("table",$,[a[59]||(a[59]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",{colspan:"4"},"-- Fechas de Producción --")]),(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Creación"),(0,t.Lk)("th",null,"Lista para Producción"),(0,t.Lk)("th",null,"Inicia Producción"),(0,t.Lk)("th",null,"Finalización")])],-1)),(0,t.Lk)("tbody",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("td",null,(0,n.v_)(oe.formatFecha(ae.detalleOrden?.fecha_creacion)),1),(0,t.Lk)("td",null,(0,n.v_)(oe.formatFecha(ae.detalleOrden?.fecha_lista_para_produccion)),1),(0,t.Lk)("td",null,(0,n.v_)(oe.formatFecha(ae.detalleOrden?.fecha_inicio)),1),(0,t.Lk)("td",null,(0,n.v_)(oe.formatFecha(ae.detalleOrden?.fecha_finalizacion)),1)])])]),(0,t.Lk)("table",V,[(0,t.Lk)("tbody",null,[(0,t.Lk)("tr",null,[a[60]||(a[60]=(0,t.Lk)("td",{class:"label"},"Creado por",-1)),(0,t.Lk)("td",S,(0,n.v_)(ae.detalleOrden?.creado_por||"N/A"),1),a[61]||(a[61]=(0,t.Lk)("td",{class:"label"},"Producido por",-1)),(0,t.Lk)("td",T,(0,n.v_)(ae.detalleOrden?.producido_por||"N/A"),1)])])]),(0,t.Lk)("table",Q,[a[62]||(a[62]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",{style:{width:"60%"}},"Componente"),(0,t.Lk)("th",{style:{width:"10%"}},"Cant. x Paquete"),(0,t.Lk)("th",{style:{width:"10%"}},"Cant. Total"),(0,t.Lk)("th",{style:{width:"10%"}},"Peso x Paquete"),(0,t.Lk)("th",{style:{width:"10%"}},"Peso Total"),(0,t.Lk)("th",{style:{width:"10%"}},"Costo Unitario"),(0,t.Lk)("th",{style:{width:"10%"}},"Costo Total")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.componentes,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.nombre},[(0,t.Lk)("td",null,(0,n.v_)(e.nombre),1),(0,t.Lk)("td",null,(0,n.v_)(e.cant_x_paquete),1),(0,t.Lk)("td",null,(0,n.v_)(e.cantidad_total.toFixed(2)),1),(0,t.Lk)("td",null,(0,n.v_)(e.peso_x_paquete),1),(0,t.Lk)("td",null,(0,n.v_)(e.peso_total.toFixed(2)),1),(0,t.Lk)("td",null,"$"+(0,n.v_)(e.costo_unitario.toFixed(2)),1),(0,t.Lk)("td",null,"$"+(0,n.v_)(e.costo_total.toFixed(2)),1)])))),128))])])])):(0,t.Q3)("",!0),!ae.detalleOrden||"En Producción"!==ae.detalleOrden.estado&&"En Producción-Parcial"!==ae.detalleOrden.estado&&"Finalizada"!==ae.detalleOrden.estado?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("section",U,[a[69]||(a[69]=(0,t.Lk)("h3",null,"Opciones de Producción",-1)),"En Producción"===ae.detalleOrden.estado||"En Producción-Parcial"===ae.detalleOrden.estado?((0,t.uX)(),(0,t.CE)("div",R,[(0,t.Lk)("button",{onClick:a[20]||(a[20]=(...e)=>oe.habilitarEntregaParcial&&oe.habilitarEntregaParcial(...e)),disabled:0===ae.cantidadPendiente}," Entrega Parcial ",8,H),(0,t.Lk)("button",{onClick:a[21]||(a[21]=(...e)=>oe.realizarEntregaTotal&&oe.realizarEntregaTotal(...e))}," Entrega Total "),"En Producción-Parcial"===ae.detalleOrden.estado?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:a[22]||(a[22]=(...e)=>oe.habilitarCierreForzado&&oe.habilitarCierreForzado(...e))}," Cierre Forzado ")):(0,t.Q3)("",!0),ae.cierreForzadoHabilitado?((0,t.uX)(),(0,t.CE)("div",B,[a[64]||(a[64]=(0,t.Lk)("label",{for:"comentario-cierre"},"Comentario de Cierre Forzado (opcional):",-1)),(0,t.bo)((0,t.Lk)("textarea",{id:"comentario-cierre","onUpdate:modelValue":a[23]||(a[23]=e=>ae.comentarioCierreForzado=e),placeholder:"Motivo del cierre forzado..."},null,512),[[r.Jo,ae.comentarioCierreForzado]]),(0,t.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>oe.confirmarCierreForzado&&oe.confirmarCierreForzado(...e))},"Confirmar Cierre")])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),ae.entregaParcialHabilitada?((0,t.uX)(),(0,t.CE)("div",J,[a[65]||(a[65]=(0,t.Lk)("label",{for:"cantidad-parcial"},"Cantidad Parcial a Entregar:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"number",id:"cantidad-parcial","onUpdate:modelValue":a[25]||(a[25]=e=>ae.cantidadParcial=e),step:"0.001",min:"0.001",max:ae.cantidadPendiente,placeholder:"Ingrese cantidad (e.g., 1.500)"},null,8,K),[[r.Jo,ae.cantidadParcial]]),a[66]||(a[66]=(0,t.Lk)("label",{for:"comentario"},"Comentario (opcional):",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"comentario","onUpdate:modelValue":a[26]||(a[26]=e=>ae.comentarioParcial=e),placeholder:"Añadir un comentario..."},null,512),[[r.Jo,ae.comentarioParcial]]),(0,t.Lk)("button",{onClick:a[27]||(a[27]=(...e)=>oe.registrarEntregaParcial&&oe.registrarEntregaParcial(...e))},"Entregar")])):(0,t.Q3)("",!0),a[70]||(a[70]=(0,t.Lk)("h3",null,"Historial de Entregas",-1)),ae.historialEntregas.length>0?((0,t.uX)(),(0,t.CE)("table",M,[a[67]||(a[67]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Cantidad Entregada"),(0,t.Lk)("th",null,"Fecha y Hora"),(0,t.Lk)("th",null,"Comentario")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ae.historialEntregas,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id},[(0,t.Lk)("td",null,(0,n.v_)(Number(e.cantidad).toFixed(2)),1),(0,t.Lk)("td",null,(0,n.v_)(oe.formatFecha(e.fecha_hora)),1),(0,t.Lk)("td",null,(0,n.v_)(e.comentario||"N/A"),1)])))),128))])])):((0,t.uX)(),(0,t.CE)("p",W,"No hay entregas registradas para esta orden.")),(0,t.Lk)("p",null,[a[68]||(a[68]=(0,t.Lk)("strong",null,"Cantidad Pendiente:",-1)),(0,t.eW)(" "+(0,n.v_)(Number(ae.cantidadPendiente).toFixed(2)),1)]),(0,t.Lk)("div",null,["Finalizada"===ae.detalleOrden.estado&&ae.detalleOrden.comentario_cierre_forzado?((0,t.uX)(),(0,t.CE)("h3",j," Orden con Cierre Forzado ")):(0,t.Q3)("",!0),"Finalizada"===ae.detalleOrden.estado&&ae.detalleOrden.comentario_cierre_forzado?((0,t.uX)(),(0,t.CE)("p",G,(0,n.v_)(ae.detalleOrden.comentario_cierre_forzado),1)):"Finalizada"===ae.detalleOrden.estado?((0,t.uX)(),(0,t.CE)("h3",Y," Orden Finalizada sin novedad ")):((0,t.uX)(),(0,t.CE)("h3",Z," Estado Actual: "+(0,n.v_)(ae.detalleOrden.estado),1))])]))])}o(4114),o(8111),o(2489),o(116),o(1701),o(4603),o(7566),o(8721);var ae=o(7682),oe=(o(292),{data(){return{productosCompuestos:[],bodegas:[],nuevaOrden:{producto_compuesto_id:null,cantidad_paquetes:null,bodega_produccion:null},codigoProductoCompuesto:"",nombreProductoCompuesto:"",filtroEstado:"",filtroNumeroOrden:"",ordenes:[],tablaRevisarVisible:!1,componentes:[],detalleOrden:{},tablaDetalleVisible:!1,historialEntregas:[],cantidadParcial:null,comentarioParcial:"",cantidadPendiente:0,entregasTotales:0,entregaParcialHabilitada:!1,mostrarDetalle:!1,cierreForzadoHabilitado:!1,comentarioCierreForzado:""}},methods:{formatFecha(e){if(!e)return"-";const a=new Date(e);if(isNaN(a.getTime())){const[a,o]=e.split(" "),[t,r,n]=a.split("-").map(Number),[d,i]=o.split(":").map(Number),l=o.includes("PM"),s=l?d%12+12:d%12,c=new Date(t,r-1,n,s,i);return isNaN(c.getTime())?"-":c.toLocaleString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return a.toLocaleString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},limpiarPagina(){this.nuevaOrden={producto_compuesto_id:null,cantidad_paquetes:null,bodega_produccion:null},this.codigoProductoCompuesto="",this.nombreProductoCompuesto="",this.filtroEstado="",this.filtroNumeroOrden="",this.ordenes=[],this.tablaRevisarVisible=!1,this.componentes=[],this.detalleOrden={},this.tablaDetalleVisible=!1,this.historialEntregas=[],this.cantidadParcial=0,this.comentarioParcial="",this.cantidadPendiente=0,this.entregasTotales=0,this.entregaParcialHabilitada=!1,this.mostrarDetalle=!1,this.cierreForzadoHabilitado=!1,this.comentarioCierreForzado="",this.cargarProductosCompuestos(),this.cargarBodegas()},sincronizarPorNombre(){const e=this.productosCompuestos.find((e=>e.nombre.toLowerCase().includes(this.nombreProductoCompuesto.toLowerCase())));e&&(this.nuevaOrden.producto_compuesto_id=e.id,this.codigoProductoCompuesto=e.codigo)},sincronizarCodigoConSelector(){const e=this.productosCompuestos.find((e=>e.codigo===this.codigoProductoCompuesto));e&&(this.nuevaOrden.producto_compuesto_id=e.id,this.nombreProductoCompuesto=e.nombre)},sincronizarSelectorConCodigo(){const e=this.productosCompuestos.find((e=>e.id===this.nuevaOrden.producto_compuesto_id));e&&(this.codigoProductoCompuesto=e.codigo,this.nombreProductoCompuesto=e.nombre)},async cargarBodegas(){try{const e=await ae.A.get("/inventory/bodegas");this.bodegas=e.data}catch(e){console.error("Error al cargar las bodegas:",e),alert("No se pudieron cargar las bodegas.")}},async cargarProductosCompuestos(){try{const e=await ae.A.get("/inventory/productos-compuestos");this.productosCompuestos=e.data.sort(((e,a)=>e.codigo.localeCompare(a.codigo)))}catch(e){console.error("Error al cargar productos compuestos:",e),alert("No se pudieron cargar los productos compuestos.")}},async consultarOrdenes(){try{let e={};this.filtroEstado&&(e.estado=this.filtroEstado),this.filtroNumeroOrden&&(e.numero_orden=this.filtroNumeroOrden);const a=await ae.A.get("/api/ordenes-produccion",{params:e});this.ordenes=a.data.sort(((e,a)=>a.id-e.id)),this.mostrarDetalle=!1,this.detalleOrden={}}catch(e){console.error("Error al consultar órdenes de producción:",e),alert("No se pudieron consultar las órdenes de producción.")}},async revisarOrden(){try{if(!this.nuevaOrden.producto_compuesto_id||!this.nuevaOrden.cantidad_paquetes)return void alert("Por favor, selecciona un producto y una cantidad válida.");const e=await ae.A.get(`/inventory/productos-compuestos/detalle?id=${this.nuevaOrden.producto_compuesto_id}`);if(!e.data.materiales||!Array.isArray(e.data.materiales))throw new Error("La respuesta del backend no contiene materiales válidos.");this.componentes=e.data.materiales.map((e=>{const a=Number(e.cantidad),o=Number(e.peso_unitario),t=Number(this.nuevaOrden.cantidad_paquetes);if(isNaN(a)||isNaN(o)||isNaN(t))throw new Error(`Valores no numéricos detectados: cantidad=${e.cantidad}, peso_unitario=${e.peso_unitario}`);return{nombre:e.producto_base_nombre,cantidad_requerida:a,cantidad_total:a*t,peso_unitario:o,peso_total:a*t*o,costo_unitario:e.costo_unitario||0,costo_total:(e.costo_unitario||0)*a*t}})),this.tablaRevisarVisible=!0}catch(e){console.error("Error al revisar orden:",e),alert("No se pudo revisar la orden: "+(e.message||"Error desconocido")),this.tablaRevisarVisible=!1}},async crearOrden(){try{const e=localStorage.getItem("usuario_id");if(!e)return console.error("No se encontró usuario_id en localStorage"),void alert("Error: No se pudo identificar al usuario autenticado. Por favor, inicia sesión nuevamente.");const a={producto_compuesto_id:this.nuevaOrden.producto_compuesto_id,cantidad_paquetes:this.nuevaOrden.cantidad_paquetes,bodega_produccion:this.nuevaOrden.bodega_produccion,creado_por:parseInt(e)};console.log("Datos enviados a POST /api/ordenes-produccion:",a);const o=await ae.A.post("/api/ordenes-produccion",a);alert(o.data.message),this.tablaRevisarVisible=!1,this.consultarOrdenes()}catch(e){console.error("Error al crear orden de producción:",e);const a=e.response?.data?.error||"No se pudo crear la orden de producción";alert(a)}},async eliminarOrden(e){try{const a=confirm("¿Estás seguro de que deseas eliminar esta orden?");if(!a)return;const o=await ae.A.delete(`/api/ordenes-produccion/${e}`);alert(o.data.message),this.ordenes=this.ordenes.filter((a=>a.id!==e)),this.detalleOrden.id===e&&(this.detalleOrden={},this.tablaDetalleVisible=!1)}catch(a){console.error("Error al eliminar la orden:",a),alert("No se pudo eliminar la orden.")}},async cargarDetalleOrden(e){try{const a=await ae.A.get(`/api/ordenes-produccion/${e}`);console.log("Respuesta de GET /api/ordenes-produccion:",a.data),this.detalleOrden={...a.data,bodega_produccion_nombre:a.data.bodega_produccion_nombre||"No especificada",costo_unitario:a.data.costo_unitario||0,costo_total:a.data.costo_total||0,comentario_cierre_forzado:a.data.comentario_cierre_forzado||"",creado_por:a.data.creado_por||"Desconocido",producido_por:a.data.producido_por||"N/A"};const o=await ae.A.get(`/inventory/productos-compuestos/detalle?id=${this.detalleOrden.producto_compuesto_id}`);this.componentes=o.data.materiales.map((e=>({nombre:e.producto_base_nombre,cant_x_paquete:e.cantidad,peso_x_paquete:e.peso_unitario,cantidad_total:e.cantidad*this.detalleOrden.cantidad_paquetes,peso_total:e.cantidad*this.detalleOrden.cantidad_paquetes*e.peso_unitario,costo_unitario:e.costo_unitario||0,costo_total:(e.costo_unitario||0)*e.cantidad*this.detalleOrden.cantidad_paquetes})));const t=await ae.A.get(`/api/ordenes-produccion/${e}/historial-entregas`);this.historialEntregas=t.data.historial||[],this.cantidadPendiente=Number(t.data.cantidad_pendiente)||0,this.tablaDetalleVisible=!0}catch(a){console.error("Error al cargar detalle de la orden:",a),alert("No se pudo cargar el detalle de la orden."),this.tablaDetalleVisible=!1}},async actualizarEstado(e,a){try{const o=localStorage.getItem("usuario_id");if(!o)return void alert("No se pudo obtener el ID del usuario logueado.");const t=await ae.A.put(`/api/ordenes-produccion/${e}/estado`,{nuevo_estado:a,usuario_id:o});alert(t.data.message),await this.consultarOrdenes(),this.detalleOrden.id===e&&await this.cargarDetalleOrden(e)}catch(o){console.error("Error al actualizar el estado de la orden:",o),alert("No se pudo actualizar el estado de la orden.")}},estadoClass(e){if(!e)return"";switch(e){case"Pendiente":return"estado-pendiente";case"Lista para Producción":return"estado-lista";case"En Producción":case"En Producción-Parcial":return"estado-produccion";case"Finalizada":return"estado-finalizada";default:return""}},habilitarEntregaParcial(){this.entregaParcialHabilitada=!0},habilitarCierreForzado(){this.cierreForzadoHabilitado=!0},async registrarEntregaParcial(){if(!this.cantidadParcial||this.cantidadParcial<=0||this.cantidadParcial>this.cantidadPendiente)alert("Por favor, ingrese una cantidad válida menor o igual a la cantidad pendiente.");else try{const e=localStorage.getItem("usuario_id");if(!e)return void alert("No se pudo obtener el ID del usuario logueado.");const a=await ae.A.post(`/api/ordenes-produccion/${this.detalleOrden.id}/entrega-parcial`,{cantidad_entregada:parseFloat(this.cantidadParcial),comentario:this.comentarioParcial||"",usuario_id:e});alert(a.data.message),this.cantidadPendiente=a.data.cantidad_pendiente||0,this.entregaParcialHabilitada=!1,this.cantidadParcial=null,this.comentarioParcial="",await this.cargarDetalleOrden(this.detalleOrden.id),await this.consultarOrdenes()}catch(e){console.error("Error al registrar entrega parcial:",e),alert(e.response?.data?.error||"No se pudo registrar la entrega parcial.")}},async realizarEntregaTotal(){try{if(!this.detalleOrden||!this.detalleOrden.id)return void alert("No se puede finalizar la orden porque no se encontró el detalle.");const e=confirm("¿Estás seguro de registrar la entrega total?");if(!e)return;const a=localStorage.getItem("usuario_id");if(!a)return void alert("No se pudo obtener el ID del usuario logueado.");const o=await ae.A.post(`/api/ordenes-produccion/${this.detalleOrden.id}/registrar-entrega-total`,{usuario_id:a});alert(o.data.message),this.cantidadPendiente=0,await this.cargarHistorialEntregas(this.detalleOrden.id),await this.cargarDetalleOrden(this.detalleOrden.id),await this.consultarOrdenes()}catch(e){console.error("Error al registrar entrega total:",e);const a=e.response?.data?.error||"Error al registrar la entrega total. Verifica el inventario o contacta al administrador.";alert(a)}},async cargarHistorialEntregas(e){try{const a=await ae.A.get(`/api/ordenes-produccion/${e}/historial-entregas`);this.historialEntregas=a.data.historial||[]}catch(a){console.error("Error al cargar historial de entregas:",a),alert("No se pudo cargar el historial de entregas.")}},async registrarProduccion(e){try{this.detalleOrden&&this.detalleOrden.id===e||await this.cargarDetalleOrden(e),"En Producción"===this.detalleOrden.estado||"En Producción-Parcial"===this.detalleOrden.estado?this.mostrarDetalle=!0:alert("La orden no está en estado válido para registrar producción.")}catch(a){console.error("Error al registrar producción:",a),alert("No se pudo mostrar las opciones de producción.")}},async confirmarCierreForzado(){try{if(!this.detalleOrden||!this.detalleOrden.id)return void alert("No se puede cerrar la orden porque no se encontró el detalle.");const e=confirm(`¿Seguro que deseas cerrar forzadamente la orden ${this.detalleOrden.numero_orden}?`);if(!e)return;const a=await ae.A.post(`/api/ordenes-produccion/${this.detalleOrden.id}/cierre-forzado`,{comentario:this.comentarioCierreForzado||""});alert(a.data.message),this.cierreForzadoHabilitado=!1,this.comentarioCierreForzado="",await this.cargarHistorialEntregas(this.detalleOrden.id),await this.cargarDetalleOrden(this.detalleOrden.id),await this.consultarOrdenes()}catch(e){console.error("Error al realizar el Cierre Forzado:",e),alert(e.response?.data?.error||"No se pudo completar el Cierre Forzado.")}},async descargarPdf(e){try{const a=await ae.A.get(`/api/ordenes-produccion/${e}/pdf`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=o,t.setAttribute("download",`Orden_${e}.pdf`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(a){console.error("Error al descargar el PDF:",a),alert("No se pudo descargar el PDF de la orden.")}},async descargarPdfOperador(e){try{const a=await ae.A.get(`/api/ordenes-produccion/${e}/pdf-operador`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=o,t.setAttribute("download",`Orden_${e}_Operador.pdf`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(a){console.error("Error al descargar el PDF para operador:",a),alert("No se pudo descargar el PDF de la orden.")}},volverAlMenu(){const e=localStorage.getItem("tipo_usuario");"admin"===e?this.$router.push("/menu"):"gerente"===e?this.$router.push("/menu-gerente"):alert("Rol no reconocido. Contacta al administrador.")}},mounted(){this.cargarProductosCompuestos(),this.cargarBodegas()}}),te=o(1241);const re=(0,te.A)(oe,[["render",ee],["__scopeId","data-v-4c67c99c"]]);var ne=re}}]);
//# sourceMappingURL=897.5464e1f1.js.map