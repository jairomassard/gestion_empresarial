"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[607],{1607:function(o,a,e){e.r(a),e.d(a,{default:function(){return K}});var t=e(6768),r=e(4232),l=e(5130);const n={class:"cargar-notas-credito"},i={class:"menu-buttons"},c={key:0,class:"form-section"},s={class:"form-group"},d={key:1,class:"form-section"},u={key:2,class:"form-section"},C={class:"form-section"},v={class:"consulta-notas-credito form-section"},p={class:"form-group"},k={class:"form-group"},h={class:"form-group"},L={class:"form-group"},f=["value"],_={key:3,class:"resultados-notas-credito form-section"},g={class:"form-actions"},m={class:"table-container"},N=["onClick"],b={key:4,class:"detalle-nota-credito form-section"},E={class:"form-actions"},x={class:"table-container"};function y(o,a,e,y,F,A){const D=(0,t.g2)("font-awesome-icon");return(0,t.uX)(),(0,t.CE)("div",n,[a[28]||(a[28]=(0,t.Lk)("h1",null,"Cargar Notas Crédito",-1)),(0,t.Lk)("section",i,[(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...o)=>y.limpiarPagina&&y.limpiarPagina(...o)),class:"btn btn-warning"},"Limpiar Página")]),y.hasPermission("inventario","notas_credito","editar")?((0,t.uX)(),(0,t.CE)("section",c,[a[13]||(a[13]=(0,t.Lk)("h2",null,"Subir Archivo CSV",-1)),(0,t.Lk)("div",s,[a[11]||(a[11]=(0,t.Lk)("label",{for:"inputCsv"},"Archivo CSV:",-1)),(0,t.Lk)("input",{id:"inputCsv",type:"file",onChange:a[1]||(a[1]=(...o)=>y.cargarCsv&&y.cargarCsv(...o)),ref:"inputCsv"},null,544),a[12]||(a[12]=(0,t.Lk)("p",null,"El CSV debe incluir: nota_credito, factura, codigo, nombre, cantidad, fecha_devolucion",-1))]),(0,t.Lk)("button",{onClick:a[2]||(a[2]=(...o)=>y.procesarCsv&&y.procesarCsv(...o))},"Cargar Notas Crédito")])):((0,t.uX)(),(0,t.CE)("section",d,a[14]||(a[14]=[(0,t.Lk)("p",null,"No tienes permiso para cargar notas de crédito.",-1)]))),y.errores.length?((0,t.uX)(),(0,t.CE)("section",u,[a[15]||(a[15]=(0,t.Lk)("h2",null,"Errores Detectados:",-1)),(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(y.errores,((o,a)=>((0,t.uX)(),(0,t.CE)("li",{key:a},(0,r.v_)(o),1)))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("section",C,[a[16]||(a[16]=(0,t.Lk)("h2",null,"Descargar Plantilla",-1)),(0,t.Lk)("button",{onClick:a[3]||(a[3]=(...o)=>y.descargarPlantilla&&y.descargarPlantilla(...o))},"Descargar")]),(0,t.Lk)("section",v,[a[22]||(a[22]=(0,t.Lk)("h2",null,"Consulta de Notas Crédito",-1)),(0,t.Lk)("div",p,[a[17]||(a[17]=(0,t.Lk)("label",{for:"filtroNotaCredito"},"Número de Nota Crédito:",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[4]||(a[4]=o=>y.filtroNotaCredito=o),id:"filtroNotaCredito",placeholder:"Ingrese número de nota crédito"},null,512),[[l.Jo,y.filtroNotaCredito]])]),(0,t.Lk)("div",k,[a[18]||(a[18]=(0,t.Lk)("label",{for:"fechaInicio"},"Fecha Inicio:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"date","onUpdate:modelValue":a[5]||(a[5]=o=>y.fechaInicio=o),id:"fechaInicio"},null,512),[[l.Jo,y.fechaInicio]])]),(0,t.Lk)("div",h,[a[19]||(a[19]=(0,t.Lk)("label",{for:"fechaFin"},"Fecha Fin:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=o=>y.fechaFin=o),id:"fechaFin"},null,512),[[l.Jo,y.fechaFin]])]),(0,t.Lk)("div",L,[a[21]||(a[21]=(0,t.Lk)("label",{for:"selectorNotaCredito"},"Seleccionar Nota Crédito:",-1)),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=o=>y.filtroNotaCredito=o),id:"selectorNotaCredito"},[a[20]||(a[20]=(0,t.Lk)("option",{value:"",disabled:""},"Seleccione una nota crédito",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(y.notasCredito,(o=>((0,t.uX)(),(0,t.CE)("option",{key:o,value:o},(0,r.v_)(o),9,f)))),128))],512),[[l.u1,y.filtroNotaCredito]])]),(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...o)=>y.consultarNotasCredito&&y.consultarNotasCredito(...o))},"Consultar Notas Crédito")]),y.resultadosNotasCredito.length?((0,t.uX)(),(0,t.CE)("section",_,[a[25]||(a[25]=(0,t.Lk)("h3",null,"Resultados de la Consulta",-1)),(0,t.Lk)("div",g,[(0,t.Lk)("button",{onClick:a[9]||(a[9]=(...o)=>y.exportarListadoExcel&&y.exportarListadoExcel(...o))},[a[23]||(a[23]=(0,t.eW)(" Exportar Listado ")),(0,t.bF)(D,{icon:"file-excel",class:"excel-icon"})])]),(0,t.Lk)("div",m,[(0,t.Lk)("table",null,[a[24]||(a[24]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Número de Nota Crédito"),(0,t.Lk)("th",null,"Fecha y Hora"),(0,t.Lk)("th",null,"Acción")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(y.resultadosNotasCredito,(o=>((0,t.uX)(),(0,t.CE)("tr",{key:o.nota_credito},[(0,t.Lk)("td",null,(0,r.v_)(o.nota_credito),1),(0,t.Lk)("td",null,(0,r.v_)(o.fecha),1),(0,t.Lk)("td",null,[(0,t.Lk)("button",{onClick:a=>y.verDetalleNotaCredito(o.nota_credito),class:"btn btn-info"},"Detalle",8,N)])])))),128))])])])])):(0,t.Q3)("",!0),y.detalleNotaCredito.length?((0,t.uX)(),(0,t.CE)("section",b,[(0,t.Lk)("h3",null,"Detalle de la Nota Crédito "+(0,r.v_)(y.notaCreditoSeleccionada),1),(0,t.Lk)("div",E,[(0,t.Lk)("button",{onClick:a[10]||(a[10]=(...o)=>y.exportarDetalleExcel&&y.exportarDetalleExcel(...o))},[a[26]||(a[26]=(0,t.eW)(" Exportar ")),(0,t.bF)(D,{icon:"file-excel",class:"excel-icon"})])]),(0,t.Lk)("div",x,[(0,t.Lk)("table",null,[a[27]||(a[27]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Código"),(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Cantidad Devuelta"),(0,t.Lk)("th",null,"Bodega"),(0,t.Lk)("th",null,"Costo Unitario"),(0,t.Lk)("th",null,"Costo Total")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(y.detalleNotaCredito,(o=>((0,t.uX)(),(0,t.CE)("tr",{key:o.codigo},[(0,t.Lk)("td",null,(0,r.v_)(o.codigo),1),(0,t.Lk)("td",null,(0,r.v_)(o.nombre),1),(0,t.Lk)("td",null,(0,r.v_)(o.cantidad),1),(0,t.Lk)("td",null,(0,r.v_)(o.bodega),1),(0,t.Lk)("td",null,(0,r.v_)(o.costo_unitario?`$${o.costo_unitario.toFixed(2)}`:"N/A"),1),(0,t.Lk)("td",null,(0,r.v_)(o.costo_total?`$${o.costo_total.toFixed(2)}`:"N/A"),1)])))),128))])])])])):(0,t.Q3)("",!0)])}e(4114),e(8111),e(116),e(1701),e(4603),e(7566),e(8721);var F=e(144),A=e(782),D=e(1387),R=e(7682),S=e(3230),I={name:"CargarNotasCredito",setup(){const o=(0,A.Pj)(),a=(0,D.rd)(),e=(0,F.KR)(null),t=(0,F.KR)(null),r=(0,F.KR)([]),l=(0,F.KR)(""),n=(0,F.KR)(""),i=(0,F.KR)(""),c=(0,F.KR)([]),s=(0,F.KR)([]),d=(0,F.KR)([]),u=(0,F.KR)(""),C=o=>{e.value=o.target.files[0]},v=async()=>{if(!e.value)return void alert("Seleccione un archivo para cargar");const o=new FormData;o.append("file",e.value);try{const a=await R.A.post("/api/cargar_notas_credito",o,{headers:{"Content-Type":"multipart/form-data"}});alert(a.data.message),r.value=[],f(),p()}catch(a){console.error("Error al cargar notas crédito:",a),a.response&&a.response.data.errors?r.value=a.response.data.errors:alert("Ocurrió un error al cargar las notas crédito")}},p=()=>{e.value=null,t.value&&(t.value.value="")},k=()=>{const o=[["nota_credito","factura","codigo","nombre","cantidad","fecha_devolucion"],["ABC123","FB1234567","PROD0051","GASEOSA 1.5 LT COCA COLA","5","2025-04-12 10:00:00"],["NC001","FB1234567","PROD0051","GASEOSA 1.5 LT COCA COLA","2","2025-04-12 17:00:00"]],a=o.map((o=>o.join(","))).join("\n"),e=new Blob([a],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.setAttribute("download","plantilla_cargue_notas_credito.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},h=()=>{const o=localStorage.getItem("tipo_usuario");"admin"===o||"gerente"===o||alert("Rol no reconocido. Contacta al administrador."),a.push("/inventory")},L=()=>{p(),r.value=[],l.value="",n.value="",i.value="",s.value=[],d.value=[],u.value=""},f=async()=>{try{const o=await R.A.get("/api/notas_credito");c.value=o.data.notas_credito}catch(o){console.error("Error al cargar notas crédito:",o),alert("No se pudo cargar la lista de notas de crédito.")}},_=async()=>{try{const o={nota_credito:l.value||void 0,fecha_inicio:n.value||void 0,fecha_fin:i.value||void 0},a=await R.A.get("/api/consultar_notas_credito",{params:o});s.value=a.data,d.value=[]}catch(o){console.error("Error al consultar notas crédito:",o),alert("Ocurrió un error al consultar las notas crédito.")}},g=async o=>{try{u.value=o;const a=await R.A.get("/api/detalle_nota_credito",{params:{nota_credito:o}});d.value=a.data}catch(a){console.error("Error al obtener detalle de la nota crédito:",a),alert("No se pudo recuperar el detalle de la nota crédito.")}},m=()=>{if(!s.value.length)return void alert("No hay datos para exportar a Excel.");const o=[["Resultado de consulta de Notas Crédito Cargadas"],[`Número de Nota Crédito: ${l.value||"Todas"}`],[`Fecha Inicio: ${n.value||"No especificada"}`],[`Fecha Fin: ${i.value||"No especificada"}`],[],["Número de Nota Crédito","Fecha y Hora"],...s.value.map((o=>[o.nota_credito,o.fecha]))],a=S.Wp.aoa_to_sheet(o),e=S.Wp.book_new();S.Wp.book_append_sheet(e,a,"Notas Crédito"),S._h(e,`notas_credito_${(new Date).toISOString().slice(0,10)}.xlsx`)},N=()=>{if(!d.value.length)return void alert("No hay datos para exportar a Excel.");const o=s.value.find((o=>o.nota_credito===u.value))?.fecha||"Desconocida",a=[[`Detalle Nota Crédito ${u.value}`],[`Fecha de Cargue: ${o}`],[],["Código","Nombre","Cantidad Devuelta","Bodega","Costo Unitario","Costo Total"],...d.value.map((o=>[o.codigo,o.nombre,o.cantidad,o.bodega,o.costo_unitario?o.costo_unitario.toFixed(2):"N/A",o.costo_total?o.costo_total.toFixed(2):"N/A"]))],e=S.Wp.aoa_to_sheet(a),t=S.Wp.book_new();S.Wp.book_append_sheet(t,e,"Detalle Nota Crédito"),S._h(t,`detalle_nota_credito_${u.value}.xlsx`)};return{archivoCsv:e,inputCsv:t,errores:r,filtroNotaCredito:l,fechaInicio:n,fechaFin:i,notasCredito:c,resultadosNotasCredito:s,detalleNotaCredito:d,notaCreditoSeleccionada:u,hasPermission:o.getters.hasPermission,cargarCsv:C,procesarCsv:v,descargarPlantilla:k,volverAlMenu:h,limpiarPagina:L,cargarNotasCredito:f,consultarNotasCredito:_,verDetalleNotaCredito:g,exportarListadoExcel:m,exportarDetalleExcel:N}},mounted(){this.hasPermission("inventario","notas_credito","ver")?this.cargarNotasCredito():alert("No tienes permiso para ver notas de crédito.")}},P=e(1241);const w=(0,P.A)(I,[["render",y],["__scopeId","data-v-6e4101f2"]]);var K=w}}]);
//# sourceMappingURL=607.2730535d.js.map